<!doctype html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta name="author" content="Geshan Manandhar"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Learn how to use Postgres string_agg function with examples of top 100 billionaires in the world, pretty fun!"><meta name="keywords" content="postgres string_agg, string_agg postgres, mysql group_concat postgres"><meta name="p:domain_verify" content="e654c68562abebfa25c291f59d7d00e8"><meta property="og:type" content="website"><meta property="og:url" content="https://geshan.com.np/blog/2023/10/postgres-string_agg/"><meta property="og:title" content="How to use the string_agg function in Postgres with examples"><meta property="og:description" content="Learn how to use Postgres string_agg function with examples of top 100 billionaires in the world, pretty fun!"><meta property="og:site_name" content="Geshan&#39;s Blog"><meta property="og:image" content="https://geshan.com.np/images/postgres-string_agg/01postgres-string_agg.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:widgets:new-embed-design" content="on"><meta name="twitter:site" content="@geshan"><meta name="twitter:creator" content="@geshan"><meta name="twitter:title" content="How to use the string_agg function in Postgres with examples"><meta name="twitter:description" content="Learn how to use Postgres string_agg function with examples of top 100 billionaires in the world, pretty fun!"><meta name="twitter:image:src" content="https://geshan.com.np/images/postgres-string_agg/01postgres-string_agg.jpg"><link rel="canonical" href="https://geshan.com.np/blog/2023/10/postgres-string_agg/"><meta property="fb:pages" content="30717799226"><meta property="fb:app_id" content="106030259434380"><meta name="monetization" content="$ilp.uphold.com/aKHWpqhphm9f"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png"><link href="/atom.xml" rel="alternate" title="Geshan&#39;s Blog" type="application/atom+xml"><title>How to use the string_agg function in Postgres with examples</title><link rel="preconnect" href="/" crossorigin><link rel="preload" href="/css/fonts.css" as="style"><link rel="preload" href="/fonts/source-sans-4/source-serif-4-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/source-sans-4/source-serif-4-latin-500-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/source-sans-pro/source-sans-pro-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="/css/fonts.css"><link rel="stylesheet" href="/css/tw-006.css"><link rel="alternate" href="/atom.xml" type="application/atom+xml" title="Geshan&#39;s Blog"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-P3NXCVQEPE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-P3NXCVQEPE');</script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWT2D9T');</script><script src="https://cdn.jsdelivr.net/npm/@statsig/js-client@3/build/statsig-js-client+session-replay+web-analytics.min.js?apikey=client-rYO7rX8WSUyyLg9pKJwymLxM71tCE0CKgxgtUj4akzK"></script><link rel="manifest" href="/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="application-name" content="Geshan.com.np"><meta name="apple-mobile-web-app-title" content="Geshan.com.np"><meta name="msapplication-starturl" content="/index.html"><meta name="theme-color" content="#6947E7"><script>if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/sw.js").then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
        console.log('ServiceWorker registration failed: ', err);
    });
  }</script></head><body class="overflow-x-hidden font-ui flex flex-col min-h-screen"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWT2D9T" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header role="banner"><div><nav class="bg-white" role="navigation"><div class="w-full md:max-w-6xl mx-auto py-4 px-4"><div class="flex items-center justify-between h-16"><div class="flex-shrink-0"><a href="/" class="flex items-center"><img class="h-12 w-12" src="/images/theme/new_logo.svg" alt="Geshan G"></a></div><div class="flex items-center gap-12"><div class="hidden sm:flex items-center gap-12"><a href="/posts/1/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">Posts </a><a href="/about/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">About Me </a><a href="https://newsletter.geshan.com.np/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">Newsletter</a></div><form class="search flex items-center" action="https://www.google.com/search" method="GET"><input type="hidden" name="sitesearch" value="geshan.com.np"><div class="relative"><input class="bg-gray-100 border border-neutralGray rounded-lg py-2 pl-10 pr-4 font-body text-sm focus:outline-none focus:ring-2 focus:ring-avocado focus:border-transparent w-40" type="text" name="q" placeholder="Search" label="search"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-neutralGray" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg></div></form><button type="button" class="sm:hidden inline-flex items-center justify-center p-2 rounded-md text-black focus:outline-none focus:ring-2 focus:ring-inset focus:ring-avocado" onclick="mobileView()" aria-controls="mobile-menu" aria-expanded="false"><span class="sr-only">Open main menu</span> <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button></div></div></div><div class="mobile-menu fixed inset-0 z-40 hidden sm:hidden bg-black bg-opacity-40" role="dialog" aria-modal="true"><div class="absolute inset-0" onclick="mobileView()" aria-hidden="true"></div><div class="mobile-menu-panel relative ml-auto flex h-full w-10/12 max-w-sm flex-col justify-start bg-white shadow-xl"><div class="flex items-center justify-between px-4 py-4 border-b border-gray-200"><div class="flex items-center gap-3"><img class="h-8 w-8" src="/images/theme/new_logo.svg" alt="Geshan G"> <span class="text-lg font-semibold text-textColor font-body">Geshan's Blog</span></div><button type="button" class="inline-flex items-center justify-center rounded-full p-2 text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-avocado" onclick="mobileView()" aria-label="Close main menu"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div><nav class="overflow-y-auto px-4 py-6 space-y-2"><a href="/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Home </a><a href="/posts/1/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Posts </a><a href="/about/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">About Me </a><a href="https://newsletter.geshan.com.np/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Newsletter</a></nav><div class="px 4 py-4 border-t border-gray-200"><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="rounded-lg bg-darkAvocado px-4 py-2 text-base font-regular font-body text-white hover:bg-avocado hover:text-black transition-colors w-2/3 mx-auto ml-4">Connect on LinkedIn</a></div></div></div></nav></div></header><main id="wrap" role="main" class="flex-grow md:px-0"><div id="content"><div class="row"><div><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Geshan&#39;s Blog",
    "alternativeHeadline": "How to use the string_agg function in Postgres with examples",
    "image": "https://geshan.com.np/images/postgres-string_agg/01postgres-string_agg.jpg",
    "editor": "Geshan Manandhar",
    "genre": "Software Engineering",
    "keywords": "postgres string_agg, string_agg postgres, mysql group_concat postgres",
    "url": "https://geshan.com.np/blog/2023/10/postgres-string_agg/",
    "datePublished": "2023-10-27",
    "dateCreated": "2023-10-27",
    "dateModified": "2023-10-27",
    "description": "Learn how to use Postgres string_agg function with examples of top 100 billionaires in the world, pretty fun!",
    "articleBody": "Are you a software engineer who works with PostgreSQL? Do you often find yourself needing to manipulate and aggregate strings in your database? If so, you&#39;re in luck because PostgreSQL provides a powerful function called string_agg. In this blog post, you dive into what string_agg is, how it&#39;s related to MySQL&#39;s group_concat, and walk through a couple of examples using real data. By the end, you&#39;ll have a solid understanding of how to make the most string_agg in your PostgreSQL queries. Let’s get going!Table of contents #Postgres string_aggRelated to MySQL group_concatExample of billionaires dataList the billionaires by country and birth year with count per countryList the billionaires by category and count per categoryConclusionPostgres string_agg #Postgres string_agg is an aggregate function that allows you to concatenate values from multiple rows into a single string. It is particularly useful when dealing with string aggregation or concatenation in a SQL query. This function can be applied to columns of text, varchar, or other string types. The basic syntax of string_agg is as follows:string_agg(expression, delimiter)The two parts are expression and delimeter:expression: The expression or column you want to concatenate.delimiter: The separator that will be inserted between the concatenated values.For instance, you have customers in multiple countries, and for a campaign, you want to send emails to them. The need is to get all the customer emails grouped by country it can be done with a query that looks like the below:SELECT country.name, string_agg(customer.email, ‘, ’)FROM customer INNER JOIN country ON customer.country_id = country.id GROUP By country.nameRelated to MySQL group_concat #If you&#39;re familiar with MySQL, you might have used the group_concat function. string_agg in Postgres serves a similar purpose as group_concat in MySQL. They both allow you to aggregate and concatenate values from multiple rows into a single string. However, there are some syntax and implementation differences between the two.Below is an example of the usage of group_concat taken directly form the MySQL docs:SELECT student_name,         GROUP_CONCAT(DISTINCT test_score                      ORDER BY test_score DESC SEPARATOR &#39; &#39;)FROM studentGROUP BY student_name;Here the query will get the distinct test_score highest first grouped by student and separated by a space character.Now that we have a clear understanding of what string_agg is and how it compares to group_concat, let&#39;s move on to some practical examples using real data of billionaires of the world.Example of billionaires data #Yes, you heard it right, the top 100 billionaires of the world. Thankfully, Kaggle has a billionaires dataset of 2023 that lists 2540 billionaires in the world with many fields. I downloaded the CSV and removed most of the fields not relevant to this example. I also took only the top 100 billionaires from that list to create a Postgres table as follows:CREATE TABLE &quot;billionaire&quot; (  &quot;id&quot; serial PRIMARY KEY,  &quot;rank&quot; integer,  &quot;worth&quot; integer,  &quot;name&quot; varchar,  &quot;gender&quot; varchar,  &quot;category&quot; varchar,  &quot;country&quot; varchar,  &quot;city&quot; varchar,  &quot;source&quot; varchar,  &quot;industries&quot; varchar,  &quot;citizenship_country&quot; varchar,  &quot;organization&quot; varchar,  &quot;title&quot; varchar,  &quot;birth_year&quot; integer);I have deliberately kept the structure very simple and have not added any index or unique indexes to the table as it will have only 100 rows. The goal of this tutorial is to understand the Postgres string_agg function, not something else. The data of the 10 (or 100) billionaires can be inserted with the following insert statement:INSERT INTO &quot;billionaire&quot; (  rank, worth, name, gender, category, country, city,   source, industries, citizenship_country, organization, title, birth_year) VALUES(1,211000,&#39;Bernard Arnault &amp;amp; family&#39;,&#39;M&#39;,&#39;Fashion &amp;amp; Retail&#39;,&#39;France&#39;,&#39;Paris&#39;,&#39;LVMH&#39;,&#39;Fashion &amp;amp; Retail&#39;,&#39;France&#39;,&#39;LVMH Moët Hennessy Louis Vuitton&#39;,&#39;Chairman and CEO&#39;,1949),(2,180000,&#39;Elon Musk&#39;,&#39;M&#39;,&#39;Automotive&#39;,&#39;United States&#39;,&#39;Austin&#39;,&#39;Tesla, SpaceX&#39;,&#39;Automotive&#39;,&#39;United States&#39;,&#39;Tesla&#39;,&#39;CEO&#39;,1971),(3,114000,&#39;Jeff Bezos&#39;,&#39;M&#39;,&#39;Technology&#39;,&#39;United States&#39;,&#39;Medina&#39;,&#39;Amazon&#39;,&#39;Technology&#39;,&#39;United States&#39;,&#39;Amazon&#39;,&#39;Chairman and Founder&#39;,1964),(4,107000,&#39;Larry Ellison&#39;,&#39;M&#39;,&#39;Technology&#39;,&#39;United States&#39;,&#39;Lanai&#39;,&#39;Oracle&#39;,&#39;Technology&#39;,&#39;United States&#39;,&#39;Oracle&#39;,&#39;CTO and Founder&#39;,1944),(5,106000,&#39;Warren Buffett&#39;,&#39;M&#39;,&#39;Finance &amp;amp; Investments&#39;,&#39;United States&#39;,&#39;Omaha&#39;,&#39;Berkshire Hathaway&#39;,&#39;Finance &amp;amp; Investments&#39;,&#39;United States&#39;,&#39;Berkshire Hathaway Inc. (Cl A)&#39;,&#39;CEO&#39;,1930),(6,104000,&#39;Bill Gates&#39;,&#39;M&#39;,&#39;Technology&#39;,&#39;United States&#39;,&#39;Medina&#39;,&#39;Microsoft&#39;,&#39;Technology&#39;,&#39;United States&#39;,&#39;Bill &amp;amp; Melinda Gates Foundation&#39;,&#39;Cochair&#39;,1955),(7,94500,&#39;Michael Bloomberg&#39;,&#39;M&#39;,&#39;Media &amp;amp; Entertainment&#39;,&#39;United States&#39;,&#39;New York&#39;,&#39;Bloomberg LP&#39;,&#39;Media &amp;amp; Entertainment&#39;,&#39;United States&#39;,&#39;Bloomberg&#39;,&#39;CEO&#39;,1942),(8,93000,&#39;Carlos Slim Helu &amp;amp; family&#39;,&#39;M&#39;,&#39;Telecom&#39;,&#39;Mexico&#39;,&#39;Mexico City&#39;,&#39;Telecom&#39;,&#39;Telecom&#39;,&#39;Mexico&#39;,&#39;América Móvil&#39;,&#39;Honorary Chairman&#39;,1940),(9,83400,&#39;Mukesh Ambani&#39;,&#39;M&#39;,&#39;Diversified&#39;,&#39;India&#39;,&#39;Mumbai&#39;,&#39;Diversified&#39;,&#39;Diversified&#39;,&#39;India&#39;,&#39;Reliance Industries&#39;,&#39;Founder and Chairman&#39;,1957),(10,80700,&#39;Steve Ballmer&#39;,&#39;M&#39;,&#39;Technology&#39;,&#39;United States&#39;,&#39;Hunts Point&#39;,&#39;Microsoft&#39;,&#39;Technology&#39;,&#39;United States&#39;,&#39;Los Angeles Clippers&#39;,&#39;Owner&#39;,1956);The above is not the full list of top 100 billionares in 2023, it is just the 10. You can get the full list of top 100 in this gist.You can run Postgres with Docker and Docker Compose locally. Still, The easiest way for you to test this without needing to install Postgres locally will be to use ElephantSQL. Their free plan will give you a database with a max of 20MB of data and 5 concurrent connections which is more than enough to try out this example. You can follow their official getting started documentation to set up a database and insert the date using the above SQL statements.Once you have the database set up with the 100 rows added. You can ask various questions as you will do in the next section.List the billionaires by country and birth year with count per country #You can get answers to questions like listing all the billionaires by country and year of birth youngest first with the count by country. It can be done easily by using the  some code In this query, the string_agg function will concatenate billionaire names along with their birth years (ordered by birth year in descending order) within each country group and count the number of billionaires in each country, ultimately sorting the results by the number of billionaires in descending order.Did you notice any difference? In this query, we added &#39;WITHIN GROUP&#39;. The key distinction is that the previous query applies the ordering to the entire result set, whereas in this one, we ensure that the concatenation is ordered within each country group as well.Why does this matter? Consider a scenario where the order of items in the concatenated string is crucial, such as when creating a comma-separated list of items in a specific sequence. The WITHIN GROUP extension empowers you to control this order, providing a powerful tool for precise string aggregation.It&#39;s important to note that if the order of items is not significant for your use case, you can continue to use string_agg without WITHIN GROUP as demonstrated earlier.Conclusion #PostgreSQL&#39;s string_agg function is a powerful tool for string aggregation in SQL queries. It allows you to concatenate values from multiple rows into a single string, making it ideal for tasks such as generating comma-separated lists or creating custom reports.In this blog post, you found out what string_agg is and how it relates to MySQL&#39;s group_concat. You also learned its practical use with real data, including listing billionaires by country and category.The next time you find yourself working on a PostgreSQL project that involves string aggregation, remember the string_agg function and how it can simplify your queries and data processing. Happy querying!",
    "author": { "@type": "Person", "name": "Geshan Manandhar" },
    "publisher": {
      "@type": "Organization",
      "name": "Geshan Manandhar",
      "logo": { "@type": "ImageObject", "url": "https://geshan.com.np/images/favicons/favicon-32x32.png" }
    },
    "mainEntityOfPage": { "@type": "WebPage", "@id": "https://geshan.com.np/blog/2023/10/postgres-string_agg/" }
  }</script><div class="progress-bar"></div><div class="max-w-6xl py-3 mx-auto grid-cols-12 grid gap-15 px-4 md:px-0 mb-20"><div class="col-span-12"><article class="md:w-full mx-auto"><header class="page-header text-center"><h1 class="font-semibold font-heading text-gray text-center mb-6 tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to use the string_agg function in Postgres with examples</h1><div class="flex items-center justify-between gap-3 md:gap-4 flex-wrap md:flex-nowrap py-2 border-y border-lightbg mt-4"><div class="flex items-center justify-start md:gap-4 gap-2 flex-wrap w-2/3"><div class="flex justify-start items-center gap-3 md:gap-4"><img src="/images/favicons/favicon-32x32-pp.png" alt="Geshan Manandhar" class="w-10 h-10 rounded-full object-cover flex-shrink-0"> <span class="text-gray font-medium font-ui text-md md:text-xl uppercase tracking-wide text-start">Geshan Manandhar</span></div><time datetime="2023-10-27" data-updated="true"><time class="entry-date" datetime="2023-10-27"><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">27-Oct-2023 </span></time></time><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">12 MIN READ</span></div><button type="button" id="share-button" class="flex items-center justify-center w-8 h-8 md:w-9 md:h-9 rounded text-lightGray hover:border-gray-400 hover:bg-gray-50 transition-colors flex-shrink-0" aria-label="Share this post" onclick="toggleShareIcons(); ga('send', 'event', 'share', 'clickShareOnPost');"><img src="/images/shareIcon.svg" alt="Share this post" class="w-6 h-6"></button></div><div id="share-icons-container" class="share-icons print:hidden hidden" aria-label="Share this post"><div class="flex items-center justify-center gap-3"><span class="share-icons"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://geshan.com.np/blog/2023/10/postgres-string_agg/" target="_blank" title="Share 'How to use the string_agg function in Postgres with examples' on LinkedIn" onclick="ga('send', 'event', 'share', 'clickShareOnLinkedIn');"><span id="linkedin-share" class="text-[#0077B5]"><img src="/images/social-icons/linkedin.svg" alt="LinkedIn" class="sharing-common"> </span></a><a href="http://twitter.com/share?text=How to use the string_agg function in Postgres with examples - &url=https://geshan.com.np/blog/2023/10/postgres-string_agg/" target="_blank" title="Share 'How to use the string_agg function in Postgres with examples' on Twitter" onclick="ga('send', 'event', 'share', 'clickShareOnTwitter');"><span id="twitter-share" class="text-[#1DA1F2]"><img src="/images/social-icons/twitter.svg" alt="Twitter" class="sharing-common"> </span></a><a href="http://www.facebook.com/sharer.php?u=https://geshan.com.np/blog/2023/10/postgres-string_agg/" target="_blank" title="Share 'How to use the string_agg function in Postgres with examples' on Facebook" onclick="ga('send', 'event', 'share', 'clickShareOnFacebook');"><span id="facebook-share" class="text-[#1877F2]"><img src="/images/social-icons/facebook.svg" alt="Facebook" class="sharing-common"> </span></a><a href="https://t.me/share/url?url=https://geshan.com.np/blog/2023/10/postgres-string_agg/" target="_blank" title="Share 'How to use the string_agg function in Postgres with examples' on Telegram" onclick="ga('send', 'event', 'share', 'clickShareOnTelegram');"><span id="telegram-share" class="text-[#0088cc]"><img src="/images/social-icons/telegram.svg" alt="Telegram" class="sharing-common"> </span></a><a href="https://api.whatsapp.com/send?text=https://geshan.com.np/blog/2023/10/postgres-string_agg/" target="_blank" title="Share 'How to use the string_agg function in Postgres with examples' on Whatsapp" onclick="ga('send', 'event', 'share', 'clickShareOnWhatsapp');"><span id="whatsapp-share" class="text-[#25d366]"><img src="/images/social-icons/whatsapp.svg" alt="WhatsApp" class="sharing-common"></span></a></span></div></div></header><div class="entry-content clearfix font-body text-xl text-gray"><p>Are you a software engineer who works with PostgreSQL? Do you often find yourself needing to manipulate and aggregate strings in your database? If so, you're in luck because PostgreSQL provides a powerful function called string_agg. In this blog post, you dive into what string_agg is, how it's related to MySQL's group_concat, and walk through a couple of examples using real data. By the end, you'll have a solid understanding of how to make the most string_agg in your PostgreSQL queries. Let’s get going!</p><img class="center" src="/images/postgres-string_agg/01postgres-string_agg.jpg" title="How to use the string_agg function in Postgres with examples" alt="How to use the string_agg function in Postgres with examples"><h2 id="table-of-contents" tabindex="-1">Table of contents <a class="direct-link" href="#table-of-contents">#</a></h2><ul><li><a href="#postgres-string-agg">Postgres string_agg</a></li><li><a href="#related-to-mysql-group-concat">Related to MySQL group_concat</a></li><li><a href="#example-of-billionaires-data">Example of billionaires data</a></li><li><a href="#list-the-billionaires-by-country-and-birth-year-with-count-per-country">List the billionaires by country and birth year with count per country</a></li><li><a href="#list-the-billionaires-by-category-and-count-per-category">List the billionaires by category and count per category</a></li><li><a href="#conclusion">Conclusion</a></li></ul><h2 id="postgres-string_agg" tabindex="-1">Postgres string_agg <a class="direct-link" href="#postgres-string_agg">#</a></h2><p>Postgres string_agg is an <a href="https://www.postgresql.org/docs/9.0/functions-aggregate.html">aggregate function</a> that allows you to concatenate values from multiple rows into a single string. It is particularly useful when dealing with string aggregation or concatenation in a SQL query. This function can be applied to columns of text, varchar, or other string types. The basic syntax of string_agg is as follows:</p><pre class="language-sql"><code class="language-sql">string_agg<span class="token punctuation">(</span>expression<span class="token punctuation">,</span> <span class="token keyword">delimiter</span><span class="token punctuation">)</span></code></pre><p>The two parts are expression and delimeter:</p><ul><li>expression: The expression or column you want to concatenate.</li><li>delimiter: The separator that will be inserted between the concatenated values.</li></ul><p>For instance, you have customers in multiple countries, and for a campaign, you want to send emails to them. The need is to get all the customer emails grouped by country it can be done with a query that looks like the below:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> country<span class="token punctuation">.</span>name<span class="token punctuation">,</span> string_agg<span class="token punctuation">(</span>customer<span class="token punctuation">.</span>email<span class="token punctuation">,</span> ‘<span class="token punctuation">,</span> ’<span class="token punctuation">)</span><br><span class="token keyword">FROM</span> customer <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> country <span class="token keyword">ON</span> customer<span class="token punctuation">.</span>country_id <span class="token operator">=</span> country<span class="token punctuation">.</span>id <br><span class="token keyword">GROUP</span> <span class="token keyword">By</span> country<span class="token punctuation">.</span>name</code></pre><h2 id="related-to-mysql-group_concat" tabindex="-1">Related to MySQL group_concat <a class="direct-link" href="#related-to-mysql-group_concat">#</a></h2><p>If you're familiar with MySQL, you might have used the <a href="https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html#function_group-concat">group_concat</a> function. string_agg in Postgres serves a similar purpose as group_concat in MySQL. They both allow you to aggregate and concatenate values from multiple rows into a single string. However, there are some syntax and implementation differences between the two.</p><p>Below is an example of the usage of group_concat taken directly form the MySQL docs:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> student_name<span class="token punctuation">,</span><br>         GROUP_CONCAT<span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> test_score<br>                      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> test_score <span class="token keyword">DESC</span> SEPARATOR <span class="token string">' '</span><span class="token punctuation">)</span><br><span class="token keyword">FROM</span> student<br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> student_name<span class="token punctuation">;</span></code></pre><p>Here the query will get the distinct test_score highest first grouped by student and separated by a space character.</p><p>Now that we have a clear understanding of what string_agg is and how it compares to group_concat, let's move on to some practical examples using real data of billionaires of the world.</p><h2 id="example-of-billionaires-data" tabindex="-1">Example of billionaires data <a class="direct-link" href="#example-of-billionaires-data">#</a></h2><p>Yes, you heard it right, the top 100 billionaires of the world. Thankfully, Kaggle has a <a href="https://www.kaggle.com/datasets/nelgiriyewithana/billionaires-statistics-dataset">billionaires dataset</a> of 2023 that lists 2540 billionaires in the world with many fields. I downloaded the CSV and removed most of the fields not relevant to this example. I also took only the top 100 billionaires from that list to create a Postgres table as follows:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">"billionaire"</span> <span class="token punctuation">(</span><br>  <span class="token string">"id"</span> <span class="token keyword">serial</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span><br>  <span class="token string">"rank"</span> <span class="token keyword">integer</span><span class="token punctuation">,</span><br>  <span class="token string">"worth"</span> <span class="token keyword">integer</span><span class="token punctuation">,</span><br>  <span class="token string">"name"</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span><br>  <span class="token string">"gender"</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span><br>  <span class="token string">"category"</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span><br>  <span class="token string">"country"</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span><br>  <span class="token string">"city"</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span><br>  <span class="token string">"source"</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span><br>  <span class="token string">"industries"</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span><br>  <span class="token string">"citizenship_country"</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span><br>  <span class="token string">"organization"</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span><br>  <span class="token string">"title"</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span><br>  <span class="token string">"birth_year"</span> <span class="token keyword">integer</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>I have deliberately kept the structure very simple and have not added any index or unique indexes to the table as it will have only 100 rows. The goal of this tutorial is to understand the Postgres string_agg function, not something else. The data of the 10 (or 100) billionaires can be inserted with the following insert statement:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token string">"billionaire"</span> <span class="token punctuation">(</span><br>  rank<span class="token punctuation">,</span> worth<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> category<span class="token punctuation">,</span> country<span class="token punctuation">,</span> city<span class="token punctuation">,</span> <br>  source<span class="token punctuation">,</span> industries<span class="token punctuation">,</span> citizenship_country<span class="token punctuation">,</span> organization<span class="token punctuation">,</span> title<span class="token punctuation">,</span> birth_year<br><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><br><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">211000</span><span class="token punctuation">,</span><span class="token string">'Bernard Arnault &amp; family'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'Fashion &amp; Retail'</span><span class="token punctuation">,</span><span class="token string">'France'</span><span class="token punctuation">,</span><span class="token string">'Paris'</span><span class="token punctuation">,</span><span class="token string">'LVMH'</span><span class="token punctuation">,</span><span class="token string">'Fashion &amp; Retail'</span><span class="token punctuation">,</span><span class="token string">'France'</span><span class="token punctuation">,</span><span class="token string">'LVMH Moët Hennessy Louis Vuitton'</span><span class="token punctuation">,</span><span class="token string">'Chairman and CEO'</span><span class="token punctuation">,</span><span class="token number">1949</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">180000</span><span class="token punctuation">,</span><span class="token string">'Elon Musk'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'Automotive'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Austin'</span><span class="token punctuation">,</span><span class="token string">'Tesla, SpaceX'</span><span class="token punctuation">,</span><span class="token string">'Automotive'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Tesla'</span><span class="token punctuation">,</span><span class="token string">'CEO'</span><span class="token punctuation">,</span><span class="token number">1971</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">114000</span><span class="token punctuation">,</span><span class="token string">'Jeff Bezos'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'Technology'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Medina'</span><span class="token punctuation">,</span><span class="token string">'Amazon'</span><span class="token punctuation">,</span><span class="token string">'Technology'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Amazon'</span><span class="token punctuation">,</span><span class="token string">'Chairman and Founder'</span><span class="token punctuation">,</span><span class="token number">1964</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">107000</span><span class="token punctuation">,</span><span class="token string">'Larry Ellison'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'Technology'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Lanai'</span><span class="token punctuation">,</span><span class="token string">'Oracle'</span><span class="token punctuation">,</span><span class="token string">'Technology'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Oracle'</span><span class="token punctuation">,</span><span class="token string">'CTO and Founder'</span><span class="token punctuation">,</span><span class="token number">1944</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">106000</span><span class="token punctuation">,</span><span class="token string">'Warren Buffett'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'Finance &amp; Investments'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Omaha'</span><span class="token punctuation">,</span><span class="token string">'Berkshire Hathaway'</span><span class="token punctuation">,</span><span class="token string">'Finance &amp; Investments'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Berkshire Hathaway Inc. (Cl A)'</span><span class="token punctuation">,</span><span class="token string">'CEO'</span><span class="token punctuation">,</span><span class="token number">1930</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">104000</span><span class="token punctuation">,</span><span class="token string">'Bill Gates'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'Technology'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Medina'</span><span class="token punctuation">,</span><span class="token string">'Microsoft'</span><span class="token punctuation">,</span><span class="token string">'Technology'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Bill &amp; Melinda Gates Foundation'</span><span class="token punctuation">,</span><span class="token string">'Cochair'</span><span class="token punctuation">,</span><span class="token number">1955</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">94500</span><span class="token punctuation">,</span><span class="token string">'Michael Bloomberg'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'Media &amp; Entertainment'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'New York'</span><span class="token punctuation">,</span><span class="token string">'Bloomberg LP'</span><span class="token punctuation">,</span><span class="token string">'Media &amp; Entertainment'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Bloomberg'</span><span class="token punctuation">,</span><span class="token string">'CEO'</span><span class="token punctuation">,</span><span class="token number">1942</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">93000</span><span class="token punctuation">,</span><span class="token string">'Carlos Slim Helu &amp; family'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'Telecom'</span><span class="token punctuation">,</span><span class="token string">'Mexico'</span><span class="token punctuation">,</span><span class="token string">'Mexico City'</span><span class="token punctuation">,</span><span class="token string">'Telecom'</span><span class="token punctuation">,</span><span class="token string">'Telecom'</span><span class="token punctuation">,</span><span class="token string">'Mexico'</span><span class="token punctuation">,</span><span class="token string">'América Móvil'</span><span class="token punctuation">,</span><span class="token string">'Honorary Chairman'</span><span class="token punctuation">,</span><span class="token number">1940</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">83400</span><span class="token punctuation">,</span><span class="token string">'Mukesh Ambani'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'Diversified'</span><span class="token punctuation">,</span><span class="token string">'India'</span><span class="token punctuation">,</span><span class="token string">'Mumbai'</span><span class="token punctuation">,</span><span class="token string">'Diversified'</span><span class="token punctuation">,</span><span class="token string">'Diversified'</span><span class="token punctuation">,</span><span class="token string">'India'</span><span class="token punctuation">,</span><span class="token string">'Reliance Industries'</span><span class="token punctuation">,</span><span class="token string">'Founder and Chairman'</span><span class="token punctuation">,</span><span class="token number">1957</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">80700</span><span class="token punctuation">,</span><span class="token string">'Steve Ballmer'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'Technology'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Hunts Point'</span><span class="token punctuation">,</span><span class="token string">'Microsoft'</span><span class="token punctuation">,</span><span class="token string">'Technology'</span><span class="token punctuation">,</span><span class="token string">'United States'</span><span class="token punctuation">,</span><span class="token string">'Los Angeles Clippers'</span><span class="token punctuation">,</span><span class="token string">'Owner'</span><span class="token punctuation">,</span><span class="token number">1956</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The above is not the full list of top 100 billionares in 2023, it is just the 10. You can get the full list of top 100 in this <a href="https://gist.github.com/geshan/b2495283109e19a8e19af837a5c8eb50#file-02billionarire-data-sql">gist</a>.</p><p>You can run <a href="/blog/2021/12/docker-postgres/">Postgres with Docker</a> and Docker Compose locally. Still, The easiest way for you to test this without needing to install Postgres locally will be to use ElephantSQL. Their <a href="https://www.elephantsql.com/plans.html">free plan</a> will give you a database with a max of 20MB of data and 5 concurrent connections which is more than enough to try out this example. You can follow their official <a href="https://www.elephantsql.com/docs/index.html">getting started documentation</a> to set up a database and insert the date using the above SQL statements.</p><p>Once you have the database set up with the 100 rows added. You can ask various questions as you will do in the next section.</p><h2 id="list-the-billionaires-by-country-and-birth-year-with-count-per-country" tabindex="-1">List the billionaires by country and birth year with count per country <a class="direct-link" href="#list-the-billionaires-by-country-and-birth-year-with-count-per-country">#</a></h2><p>You can get answers to questions like listing all the billionaires by country and year of birth youngest first with the count by country. It can be done easily by using the <code>string_agg</code> function in Postgres as below:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span><br>    b<span class="token punctuation">.</span>country<span class="token punctuation">,</span><br>    STRING_AGG <span class="token punctuation">(</span><br>	    b<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">' - '</span> <span class="token operator">||</span> b<span class="token punctuation">.</span>birth_year<span class="token punctuation">,</span> <span class="token string">', '</span><br>      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> b<span class="token punctuation">.</span>birth_year <span class="token keyword">DESC</span><br>    <span class="token punctuation">)</span> <span class="token keyword">AS</span> billionaire_birth_year<span class="token punctuation">,</span><br>    <span class="token function">COUNT</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">as</span> no_of_billionaires<br><span class="token keyword">FROM</span><br>    billionaire b<br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span><br>    b<span class="token punctuation">.</span>country<br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> no_of_billionaires <span class="token keyword">DESC</span><span class="token punctuation">;</span></code></pre><p>The output will look like the below:</p><img class="center" src="/images/postgres-string_agg/02postgres-string_agg-example.jpg" title="Top 100 Billionares with Birth year by country and count per country" alt="Top 100 Billionares with Birth year by country and count per country"><p>The output has been truncated with the top 10 rows but it will list all the 20 rows/countries if you run it on ElephantSQL Browser or any other CLI tool like <a href="https://www.postgresql.org/docs/current/app-psql.html">psql</a> or a GUI like <a href="https://www.jetbrains.com/datagrip/">DataGrip</a>. You can already see the power of string_agg function in PostgreSQL. Let’s ask one more question in the next section and that will be all the examples.</p><h2 id="list-the-billionaires-by-category-and-count-per-category" tabindex="-1">List the billionaires by category and count per category <a class="direct-link" href="#list-the-billionaires-by-category-and-count-per-category">#</a></h2><p>The query this time is which category of work has the most billionaires and list the names alphabetically and number of billionaires by category. It can be achieved by:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span><br>    b<span class="token punctuation">.</span>category<span class="token punctuation">,</span><br>    STRING_AGG <span class="token punctuation">(</span><br>	    b<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">', '</span><br>      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> b<span class="token punctuation">.</span>name <span class="token keyword">ASC</span><br>    <span class="token punctuation">)</span> <span class="token keyword">AS</span> billionaire_names<span class="token punctuation">,</span><br>    <span class="token function">COUNT</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">as</span> no_of_billionaires<br><span class="token keyword">FROM</span><br>    billionaire b<br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span><br>    b<span class="token punctuation">.</span>category<br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> no_of_billionaires <span class="token keyword">DESC</span><span class="token punctuation">;</span></code></pre><p>The output will look like the below:</p><img class="center" src="/images/postgres-string_agg/03postgres-string_agg-billionaires.jpg" title="Top 100 Billionaires by category and count per category" alt="Top 100 Billionaires by category and count per category"><p>Surely in 2023, there will be more billionaires making their money from the technology category than any other. For instance, in the top 100 billionaires of the world Real Estate has 2 whereas tech has 16, so work in tech :). You can play around with the data and ask more questions to get more insights with SQL and string_agg.</p><h2 id="using-string_agg-with-within-group" tabindex="-1">Using string_agg with WITHIN GROUP <a class="direct-link" href="#using-string_agg-with-within-group">#</a></h2><p>In addition to the basic usage of string_agg, PostgreSQL provides an extension to this function called WITHIN GROUP, allowing you to specify the order in which values are concatenated within each group, which is particularly valuable when the sequence of items in the concatenated string is significant.</p><p>The syntax for using WITHIN GROUP is as follows:</p><pre class="language-sql"><code class="language-sql">string_agg<span class="token punctuation">(</span>expression<span class="token punctuation">,</span> <span class="token keyword">delimiter</span><span class="token punctuation">)</span> <span class="token keyword">WITHIN</span> <span class="token keyword">GROUP</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ordering_expression<span class="token punctuation">)</span></code></pre><p>The WITHIN GROUP extension in PostgreSQL's string_agg function enables ordered concatenation, providing control over the sequence of values within each group. This functionality proves especially useful for tasks like listing products sorted by prices.</p><p>Let's update the aforementioned query to obtain answers to questions such as listing all the billionaires by country and year of birth, with the youngest first, along with the count by country:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span><br>    b<span class="token punctuation">.</span>country<span class="token punctuation">,</span><br>    STRING_AGG <span class="token punctuation">(</span><br>        b<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">' - '</span> <span class="token operator">||</span> b<span class="token punctuation">.</span>birth_year<span class="token punctuation">,</span> <span class="token string">', '</span><br>        <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> b<span class="token punctuation">.</span>birth_year <span class="token keyword">DESC</span><br>        <span class="token keyword">WITHIN</span> <span class="token keyword">GROUP</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> b<span class="token punctuation">.</span>birth_year <span class="token keyword">DESC</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span> <span class="token keyword">AS</span> billionaire_birth_year<span class="token punctuation">,</span><br>    <span class="token function">COUNT</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">as</span> no_of_billionaires<br><span class="token keyword">FROM</span><br>    billionaire b<br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span><br>    b<span class="token punctuation">.</span>country<br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> no_of_billionaires <span class="token keyword">DESC</span><span class="token punctuation">;</span></code></pre><p>In this query, the string_agg function will concatenate billionaire names along with their birth years (ordered by birth year in descending order) within each country group and count the number of billionaires in each country, ultimately sorting the results by the number of billionaires in descending order.</p><p>Did you notice any difference? In this query, we added 'WITHIN GROUP'. The key distinction is that the previous query applies the ordering to the entire result set, whereas in this one, we ensure that the concatenation is ordered within each country group as well.</p><p>Why does this matter? Consider a scenario where the order of items in the concatenated string is crucial, such as when creating a comma-separated list of items in a specific sequence. The WITHIN GROUP extension empowers you to control this order, providing a powerful tool for precise string aggregation.</p><p>It's important to note that if the order of items is not significant for your use case, you can continue to use string_agg without WITHIN GROUP as demonstrated earlier.</p><h2 id="conclusion" tabindex="-1">Conclusion <a class="direct-link" href="#conclusion">#</a></h2><p>PostgreSQL's string_agg function is a powerful tool for string aggregation in SQL queries. It allows you to concatenate values from multiple rows into a single string, making it ideal for tasks such as generating comma-separated lists or creating custom reports.</p><p>In this blog post, you found out what string_agg is and how it relates to MySQL's group_concat. You also learned its practical use with real data, including listing billionaires by country and category.</p><p>The next time you find yourself working on a PostgreSQL project that involves string aggregation, remember the string_agg function and how it can simplify your queries and data processing. Happy querying!</p></div><div class="flex items-center justify-between gap-3 md:gap-4 flex-wrap md:flex-nowrap py-2 border-y border-lightbg mt-4"><div class="flex items-center justify-start md:gap-4 gap-2 flex-wrap w-2/3"><div class="flex justify-start items-center gap-3 md:gap-4"><img src="/images/favicons/favicon-32x32-pp.png" alt="Geshan Manandhar" class="w-10 h-10 rounded-full object-cover flex-shrink-0"> <span class="text-gray font-medium font-ui text-md md:text-xl uppercase tracking-wide text-start">Geshan Manandhar</span></div><time datetime="2023-10-27" data-updated="true"><time class="entry-date" datetime="2023-10-27"><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">27-Oct-2023 </span></time></time><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">12 MIN READ</span></div><button type="button" id="share-button-bottom" class="flex items-center justify-center w-8 h-8 md:w-9 md:h-9 rounded text-lightGray hover:border-gray-400 hover:bg-gray-50 transition-colors flex-shrink-0" aria-label="Share this post" onclick="toggleShareIconsBottom(); ga('send', 'event', 'share', 'clickShareOnPost');"><img src="/images/shareIcon.svg" alt="Share this post" class="w-6 h-6"></button></div><div id="share-icons-container-bottom" class="share-icons-bottom print:hidden hidden mx-auto" aria-label="Share this post"><div class="w-full flex items-center justify-center mx-auto gap-3"><span class="share-icons"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://geshan.com.np/blog/2023/10/postgres-string_agg/" target="_blank" title="Share 'How to use the string_agg function in Postgres with examples' on LinkedIn" onclick="ga('send', 'event', 'share', 'clickShareOnLinkedIn');"><span id="linkedin-share" class="text-[#0077B5]"><img src="/images/social-icons/linkedin.svg" alt="LinkedIn" class="sharing-common"> </span></a><a href="http://twitter.com/share?text=How to use the string_agg function in Postgres with examples - &url=https://geshan.com.np/blog/2023/10/postgres-string_agg/" target="_blank" title="Share 'How to use the string_agg function in Postgres with examples' on Twitter" onclick="ga('send', 'event', 'share', 'clickShareOnTwitter');"><span id="twitter-share" class="text-[#1DA1F2]"><img src="/images/social-icons/twitter.svg" alt="Twitter" class="sharing-common"> </span></a><a href="http://www.facebook.com/sharer.php?u=https://geshan.com.np/blog/2023/10/postgres-string_agg/" target="_blank" title="Share 'How to use the string_agg function in Postgres with examples' on Facebook" onclick="ga('send', 'event', 'share', 'clickShareOnFacebook');"><span id="facebook-share" class="text-[#1877F2]"><img src="/images/social-icons/facebook.svg" alt="Facebook" class="sharing-common"> </span></a><a href="https://t.me/share/url?url=https://geshan.com.np/blog/2023/10/postgres-string_agg/" target="_blank" title="Share 'How to use the string_agg function in Postgres with examples' on Telegram" onclick="ga('send', 'event', 'share', 'clickShareOnTelegram');"><span id="telegram-share" class="text-[#0088cc]"><img src="/images/social-icons/telegram.svg" alt="Telegram" class="sharing-common"> </span></a><a href="https://api.whatsapp.com/send?text=https://geshan.com.np/blog/2023/10/postgres-string_agg/" target="_blank" title="Share 'How to use the string_agg function in Postgres with examples' on Whatsapp" onclick="ga('send', 'event', 'share', 'clickShareOnWhatsapp');"><span id="whatsapp-share" class="text-[#25d366]"><img src="/images/social-icons/whatsapp.svg" alt="WhatsApp" class="sharing-common"></span></a></span></div></div></article><div class="mt-3"><a href="/blog/categories/software-engineering/" title="Software Engineering" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">software engineering </a><a href="/blog/categories/postgres/" title="Postgres" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">postgres</a></div><section class="md:w-full mx-auto mt-4"><h3 class="comments font-heading">Comments</h3><div id="disqus_thread"></div><button id="disqus_trigger" class="font-ui text-blackText hover:border-darkAvocado border-blacktext hover:shadow-lg border-2 transition ease-in-out delay-100 px-3 py-2 pt-2 mt-2 rounded-md text-center block h-auto text-xl" onclick="load_disqus()">Post a Comment</button><div id="disqus_thread" aria-live="polite"></div></section></div></div><section class="md:w-full mx-auto mt-4 bg-lightAvocado p-4 rounded-lg pb-8"><div class="max-w-6xl mx-auto md:py-12 px-4"><h2 class="text-4xl text-darkAvocado font-heading font-regular flex-shrink-0 py-8 tracking-normal leading-[105%] md:leading-[105%]"><span class="text-lightGray italic">Related</span> <span class="text-blackText">Blogs</span></h2><div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2024/12/postgres-insert-on-conflict-update/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to Upsert Data in Postgres Using INSERT ON CONFLICT UPDATE</a> <time class="font-medium text-xl text-textColor uppercase font-ui">14-Dec-2024 &nbsp;&nbsp;&nbsp; 9 min read</time><p class="text-xl text-gray font-ui">Learn how to upsert data in Postgres using the INSERT ON CONFLICT UPDATE clause with practical examples. Combine insert and update operations into one UPSERT.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2024/08/postgres-insert-multiple-rows/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to insert multiple rows in Postgres using two useful methods</a> <time class="font-medium text-xl text-textColor uppercase font-ui">14-Aug-2024 &nbsp;&nbsp;&nbsp; 10 min read</time><p class="text-xl text-gray font-ui">Learn to insert multiple rows at once in Postgres with a single insert statement and the copy command in this useful tutorial.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2024/05/postgres-rename-column/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to rename a column in Postgres, from a simple to a real-life example</a> <time class="font-medium text-xl text-textColor uppercase font-ui">26-May-2024 &nbsp;&nbsp;&nbsp; 7 min read</time><p class="text-xl text-gray font-ui">Learn how to rename a column in Postgres from a simple alter table rename column to a zero downtime real-life example.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2023/09/postgres-delete-limit/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to Use LIMIT in Postgres Delete in two roundabout ways</a> <time class="font-medium text-xl text-textColor uppercase font-ui">14-Sep-2023 &nbsp;&nbsp;&nbsp; 7 min read</time><p class="text-xl text-gray font-ui">In this guide, you will learn how to use limit in Postgres DELETE statement with a sub query and a CTE with examples of each, click and learn them now!</p></div></div></div></section><section class="bg-avocado md:py-0 py-12 px-4"><div class="max-w-6xl mx-auto"><div class="md:hidden"><h2 class="mb-4 text-3xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-base text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-base text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity w-full text-center">Follow on LinkedIn &nbsp;→</a></div><div class="hidden md:grid lg:hidden grid-cols-3 gap-8 items-center"><div class="z-10 col-span-2"><h2 class="mb-4 text-2xl md:text-4xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-xl text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-xl text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity">Follow on LinkedIn &nbsp;→</a></div><div class="flex items-center justify-end col-span-1"><img class="w-32 h-auto" src="/images/theme/new_logo.svg" alt="Geshan"></div></div><div class="hidden lg:grid grid-cols-2 gap-8 lg:gap-12 items-center justify-between h-full"><div class="z-10"><h2 class="mb-4 text-2xl md:text-4xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-xl text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><p class="text-xl text-blackText font-body font-regular mb-6">A big thank you for supporting this ad. free, unobstructive (no overlays, no pop-ups) blog.</p></div><div class="flex items-center gap-12 w-full md:w-auto justify-end self-end"><img class="w-16 md:w-32 h-auto" src="/images/theme/new_logo.svg" alt="Geshan"> <a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-xl text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity w-full md:w-auto text-center md:text-left">Follow on LinkedIn &nbsp;→</a></div></div></div></section></div></div></div></main><footer role="contentinfo"><footer class="bg-avocado sm:px-4"><div class="max-w-6xl mx-auto flex flex-col md:flex-row sm:flex-col justify-between gap-2 items-center sm:items-center md:items-center py-10 font-nav text-lightGray text-base font-regular"><div class="pb-0 sm:pb-2 text-gray"><span class="pr-4">Copyright © 2026 Geshan Manandhar.</span></div><div class="pb-0 sm:pb-2"><ul class="flex"><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> LinkedIn</a></li><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://www.twitter.com/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> Twitter</a></li><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://github.com/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> Github</a></li></ul></div></div></footer></footer><script src="/js/all.min.js" defer="defer"></script></body></html>