<!doctype html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta name="author" content="Geshan Manandhar"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="You will learn how to use Jest toHaveBeenCalledWith to test both primitive types and partial objects."><meta name="keywords" content="jest tohavebeencalledwith, jest to have been called with"><meta name="p:domain_verify" content="e654c68562abebfa25c291f59d7d00e8"><meta property="og:type" content="website"><meta property="og:url" content="https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/"><meta property="og:title" content="Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects"><meta property="og:description" content="You will learn how to use Jest toHaveBeenCalledWith to test both primitive types and partial objects."><meta property="og:site_name" content="Geshan&#39;s Blog"><meta property="og:image" content="https://geshan.com.np/images/jest-tohavebeencalledwith/01jest-tohavebeencalledwith.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:widgets:new-embed-design" content="on"><meta name="twitter:site" content="@geshan"><meta name="twitter:creator" content="@geshan"><meta name="twitter:title" content="Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects"><meta name="twitter:description" content="You will learn how to use Jest toHaveBeenCalledWith to test both primitive types and partial objects."><meta name="twitter:image:src" content="https://geshan.com.np/images/jest-tohavebeencalledwith/01jest-tohavebeencalledwith.jpg"><link rel="canonical" href="https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/"><meta property="fb:pages" content="30717799226"><meta property="fb:app_id" content="106030259434380"><meta name="monetization" content="$ilp.uphold.com/aKHWpqhphm9f"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png"><link href="/atom.xml" rel="alternate" title="Geshan&#39;s Blog" type="application/atom+xml"><title>Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects</title><link rel="preconnect" href="/" crossorigin><link rel="preload" href="/css/fonts.css" as="style"><link rel="preload" href="/fonts/source-sans-4/source-serif-4-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/source-sans-4/source-serif-4-latin-500-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/source-sans-pro/source-sans-pro-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="/css/fonts.css"><link rel="stylesheet" href="/css/tw-006.css"><link rel="alternate" href="/atom.xml" type="application/atom+xml" title="Geshan&#39;s Blog"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-P3NXCVQEPE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-P3NXCVQEPE');</script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWT2D9T');</script><script src="https://cdn.jsdelivr.net/npm/@statsig/js-client@3/build/statsig-js-client+session-replay+web-analytics.min.js?apikey=client-rYO7rX8WSUyyLg9pKJwymLxM71tCE0CKgxgtUj4akzK"></script><link rel="manifest" href="/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="application-name" content="Geshan.com.np"><meta name="apple-mobile-web-app-title" content="Geshan.com.np"><meta name="msapplication-starturl" content="/index.html"><meta name="theme-color" content="#6947E7"><script>if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/sw.js").then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
        console.log('ServiceWorker registration failed: ', err);
    });
  }</script></head><body class="overflow-x-hidden font-ui flex flex-col min-h-screen"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWT2D9T" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header role="banner"><div><nav class="bg-white" role="navigation"><div class="w-full md:max-w-6xl mx-auto py-4 px-4"><div class="flex items-center justify-between h-16"><div class="flex-shrink-0"><a href="/" class="flex items-center"><img class="h-12 w-12" src="/images/theme/new_logo.svg" alt="Geshan G"></a></div><div class="flex items-center gap-12"><div class="hidden sm:flex items-center gap-12"><a href="/posts/1/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">Posts </a><a href="/about/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">About Me </a><a href="https://newsletter.geshan.com.np/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">Newsletter</a></div><form class="search flex items-center" action="https://www.google.com/search" method="GET"><input type="hidden" name="sitesearch" value="geshan.com.np"><div class="relative"><input class="bg-gray-100 border border-neutralGray rounded-lg py-2 pl-10 pr-4 font-body text-sm focus:outline-none focus:ring-2 focus:ring-avocado focus:border-transparent w-40" type="text" name="q" placeholder="Search" label="search"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-neutralGray" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg></div></form><button type="button" class="sm:hidden inline-flex items-center justify-center p-2 rounded-md text-black focus:outline-none focus:ring-2 focus:ring-inset focus:ring-avocado" onclick="mobileView()" aria-controls="mobile-menu" aria-expanded="false"><span class="sr-only">Open main menu</span> <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button></div></div></div><div class="mobile-menu fixed inset-0 z-40 hidden sm:hidden bg-black bg-opacity-40" role="dialog" aria-modal="true"><div class="absolute inset-0" onclick="mobileView()" aria-hidden="true"></div><div class="mobile-menu-panel relative ml-auto flex h-full w-10/12 max-w-sm flex-col justify-start bg-white shadow-xl"><div class="flex items-center justify-between px-4 py-4 border-b border-gray-200"><div class="flex items-center gap-3"><img class="h-8 w-8" src="/images/theme/new_logo.svg" alt="Geshan G"> <span class="text-lg font-semibold text-textColor font-body">Geshan's Blog</span></div><button type="button" class="inline-flex items-center justify-center rounded-full p-2 text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-avocado" onclick="mobileView()" aria-label="Close main menu"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div><nav class="overflow-y-auto px-4 py-6 space-y-2"><a href="/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Home </a><a href="/posts/1/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Posts </a><a href="/about/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">About Me </a><a href="https://newsletter.geshan.com.np/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Newsletter</a></nav><div class="px 4 py-4 border-t border-gray-200"><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="rounded-lg bg-darkAvocado px-4 py-2 text-base font-regular font-body text-white hover:bg-avocado hover:text-black transition-colors w-2/3 mx-auto ml-4">Connect on LinkedIn</a></div></div></div></nav></div></header><main id="wrap" role="main" class="flex-grow md:px-0"><div id="content"><div class="row"><div><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Geshan&#39;s Blog",
    "alternativeHeadline": "Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects",
    "image": "https://geshan.com.np/images/jest-tohavebeencalledwith/01jest-tohavebeencalledwith.jpg",
    "editor": "Geshan Manandhar",
    "genre": "Javascript",
    "keywords": "jest tohavebeencalledwith, jest to have been called with",
    "url": "https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/",
    "datePublished": "2022-07-29",
    "dateCreated": "2022-07-29",
    "dateModified": "2022-07-29",
    "description": "You will learn how to use Jest toHaveBeenCalledWith to test both primitive types and partial objects.",
    "articleBody": "Jest is the most used JavaScript testing framework. In this post, you will learn how to use Jest toHaveBeenCalledWith for testing various scenarios like a partial array, partial object, multiple calls, etc. Let’s get started!Table of contents #PrerequisitesGet books by subject exampleJest tests for the scriptJest toHaveBeenCalledWith primitive typesJest toHaveBeenCalledWith partial array and objectJest toHaveBeenCalledWith multiple parametersConclusionPrerequisites #Before going into the code, below are some great to-have essentials:You should have prior experience with unit testing in JavaScript (on the browser or server with Node.js), the example will be in Node.js.Any prior experience with Jest will be helpful.Knowledge of CommonJS modules will be beneficial. It is a bit different than the ES modules standard.A general understanding of HTTP and response codes like 200, 500, etc is expected.Knowing how async and promises work in JavaScirpt will be helpful.As the requisites are stated, in the next section the example of pulling in book tiles by the subject to use Jest toHaveBeenCalledWith is introduced.Get books by subject example #To learn how to utilize Jest toHaveBeenCalledWith effectively, the example to get titles of books for a given subject will be used. You will witness a simple script that will call the  some code  with the following contents:const axios = require(&#39;axios&#39;);const helper = require(&#39;./helper&#39;);async function getBooksBySubject (subject) {  let data = [];  try {    const response = await axios.get(`https://openlibrary.org/subjects/${subject}.json`);    data = response.data;  } catch(err) {    console.log(`Error getting books: ${err.message}`, err.stack);  }    return data;}async function getTitlesBySubject (subject) {  const data = await getBooksBySubject(subject);    return helper.pluckTitles(data);}module.exports = {  getTitlesBySubject,};First, Axios and a local helper file are imported. Axios is used to make calls to the  some code  it will render the following output:You can see that both the tests have run and passed successfully. The tests can be seen as Github Actions too.Great! You have learned how to use Jest toHaveBeenCalledWith covering multiple use cases.Conclusion #In this tutorial about Jest toHaveBeenCalledWith you learned how to do the partial matching for object properties and array elements. You can also learn about running a single jest test easily to target your specific test.First, a happy path was covered with tests. Then you wrote a test to verify how the code behaves in an edge case situation. Carry on testing!",
    "author": { "@type": "Person", "name": "Geshan Manandhar" },
    "publisher": {
      "@type": "Organization",
      "name": "Geshan Manandhar",
      "logo": { "@type": "ImageObject", "url": "https://geshan.com.np/images/favicons/favicon-32x32.png" }
    },
    "mainEntityOfPage": { "@type": "WebPage", "@id": "https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" }
  }</script><div class="progress-bar"></div><div class="max-w-6xl py-3 mx-auto grid-cols-12 grid gap-15 px-4 md:px-0 mb-20"><div class="col-span-12"><article class="md:w-full mx-auto"><header class="page-header text-center"><h1 class="font-semibold font-heading text-gray text-center mb-6 tracking-[-0.01em] leading-[105%] md:leading-[105%]">Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects</h1><div class="flex items-center justify-between gap-3 md:gap-4 flex-wrap md:flex-nowrap py-2 border-y border-lightbg mt-4"><div class="flex items-center justify-start md:gap-4 gap-2 flex-wrap w-2/3"><div class="flex justify-start items-center gap-3 md:gap-4"><img src="/images/favicons/favicon-32x32-pp.png" alt="Geshan Manandhar" class="w-10 h-10 rounded-full object-cover flex-shrink-0"> <span class="text-gray font-medium font-ui text-md md:text-xl uppercase tracking-wide text-start">Geshan Manandhar</span></div><time datetime="2022-07-29" data-updated="true"><time class="entry-date" datetime="2022-07-29"><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">29-Jul-2022 </span></time></time><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">17 MIN READ</span></div><button type="button" id="share-button" class="flex items-center justify-center w-8 h-8 md:w-9 md:h-9 rounded text-lightGray hover:border-gray-400 hover:bg-gray-50 transition-colors flex-shrink-0" aria-label="Share this post" onclick="toggleShareIcons(); ga('send', 'event', 'share', 'clickShareOnPost');"><img src="/images/shareIcon.svg" alt="Share this post" class="w-6 h-6"></button></div><div id="share-icons-container" class="share-icons print:hidden hidden" aria-label="Share this post"><div class="flex items-center justify-center gap-3"><span class="share-icons"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" target="_blank" title="Share 'Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects' on LinkedIn" onclick="ga('send', 'event', 'share', 'clickShareOnLinkedIn');"><span id="linkedin-share" class="text-[#0077B5]"><img src="/images/social-icons/linkedin.svg" alt="LinkedIn" class="sharing-common"> </span></a><a href="http://twitter.com/share?text=Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects - &url=https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" target="_blank" title="Share 'Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects' on Twitter" onclick="ga('send', 'event', 'share', 'clickShareOnTwitter');"><span id="twitter-share" class="text-[#1DA1F2]"><img src="/images/social-icons/twitter.svg" alt="Twitter" class="sharing-common"> </span></a><a href="http://www.facebook.com/sharer.php?u=https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" target="_blank" title="Share 'Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects' on Facebook" onclick="ga('send', 'event', 'share', 'clickShareOnFacebook');"><span id="facebook-share" class="text-[#1877F2]"><img src="/images/social-icons/facebook.svg" alt="Facebook" class="sharing-common"> </span></a><a href="https://t.me/share/url?url=https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" target="_blank" title="Share 'Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects' on Telegram" onclick="ga('send', 'event', 'share', 'clickShareOnTelegram');"><span id="telegram-share" class="text-[#0088cc]"><img src="/images/social-icons/telegram.svg" alt="Telegram" class="sharing-common"> </span></a><a href="https://api.whatsapp.com/send?text=https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" target="_blank" title="Share 'Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects' on Whatsapp" onclick="ga('send', 'event', 'share', 'clickShareOnWhatsapp');"><span id="whatsapp-share" class="text-[#25d366]"><img src="/images/social-icons/whatsapp.svg" alt="WhatsApp" class="sharing-common"></span></a></span></div></div></header><div class="entry-content clearfix font-body text-xl text-gray"><p>Jest is the <a href="https://2021.stateofjs.com/en-US/libraries/testing/">most used</a> JavaScript testing framework. In this post, you will learn how to use Jest toHaveBeenCalledWith for testing various scenarios like a partial array, partial object, multiple calls, etc. Let’s get started!</p><img class="center" loading="lazy" src="/images/jest-tohavebeencalledwith/01jest-tohavebeencalledwith.jpg" title="How to add days to date in JavaScript" alt="How to add days to date in JavaScript"><h2 id="table-of-contents" tabindex="-1">Table of contents <a class="direct-link" href="#table-of-contents">#</a></h2><ul><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#get-books-by-subject-example">Get books by subject example</a></li><li><a href="#jest-tests-for-the-script">Jest tests for the script</a><ul><li><a href="#jest-tohavebeencalledwith-primitive-types">Jest toHaveBeenCalledWith primitive types</a></li><li><a href="#jest-tohavebeencalledwith-partial-array-and-object">Jest toHaveBeenCalledWith partial array and object</a></li><li><a href="#jest-tohavebeencalledwith-multiple-parameters">Jest toHaveBeenCalledWith multiple parameters</a></li></ul></li><li><a href="#conclusion">Conclusion</a></li></ul><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="direct-link" href="#prerequisites">#</a></h2><p>Before going into the code, below are some great to-have essentials:</p><ol><li>You should have prior experience with unit testing in JavaScript (on the browser or server with Node.js), the example will be in Node.js.</li><li>Any prior experience with Jest will be helpful.</li><li>Knowledge of <a href="https://nodejs.org/api/modules.html#modules-commonjs-modules">CommonJS modules</a> will be beneficial. It is a bit different than the <a href="https://blog.logrocket.com/commonjs-vs-es-modules-node-js/">ES modules</a> standard.</li><li>A general understanding of HTTP and response codes like 200, 500, etc is expected.</li><li>Knowing how async and promises work in JavaScirpt will be helpful.</li></ol><p>As the requisites are stated, in the next section the example of pulling in book tiles by the subject to use Jest toHaveBeenCalledWith is introduced.</p><h2 id="get-books-by-subject-example" tabindex="-1">Get books by subject example <a class="direct-link" href="#get-books-by-subject-example">#</a></h2><p>To learn how to utilize Jest toHaveBeenCalledWith effectively, the example to get titles of books for a given subject will be used. You will witness a simple script that will call the <code>openlibrary.org</code> API with <a href="https://github.com/axios/axios">Axios</a>. It will use CommonJS modules to keep things simple and focus on the testing part. The whole code is available as a <a href="https://github.com/geshan/jest-tohavebeencalledwith">GitHub repository</a> for your reference.</p><p>The main file is at <code>src/books.js</code> with the following contents:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> helper <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./helper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getBooksBySubject</span> <span class="token punctuation">(</span><span class="token parameter">subject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://openlibrary.org/subjects/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>subject<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    data <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br><br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error getting books: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <br>  <span class="token keyword">return</span> data<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getTitlesBySubject</span> <span class="token punctuation">(</span><span class="token parameter">subject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getBooksBySubject</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <br>  <span class="token keyword">return</span> helper<span class="token punctuation">.</span><span class="token function">pluckTitles</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  getTitlesBySubject<span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>First, Axios and a local helper file are imported. Axios is used to make calls to the <code>openlibrary.org</code> API. Next, you define the <code>getBooksBySubject</code> function which takes <code>subject</code> as the parameter. In that function, the Open library API’s <a href="https://openlibrary.org/dev/docs/api/subjects">Subjects endpoint</a> is called with the passed in the subject. For simplicity, no validations are done on the subject parameter coming in. If there is any error it is logged and empty data is returned, else the data from the API call is sent back to the caller.</p><p>The caller, in this case, is the <code>getTitlesBySubject</code> function which also takes in the <code>subject</code> parameter. It calls the <code>getBooksBySubject</code> method and passed the result into the <code>pluckTitles</code> method on the helper that was required at the top of the file.</p><p>Only the <code>getTitlesBySubject</code> function is exposed out from this module with <code>module.exports</code>. This is similar to making the <code>getTitlesBySubject</code> function public whereas the <code>getBooksBySubject</code> method can be regarded as a private method.</p><p>The content of the <code>src/helper.js</code> file is as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">pluckTitles</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">.</span>works <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>works<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> data<span class="token punctuation">.</span>works<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">book</span> <span class="token operator">=></span> book<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  pluckTitles<br><span class="token punctuation">}</span></code></pre><p>The helper is simple, it has only one function <code>pluckTitles</code>. It could have been put in the <code>books.js</code> module but it has been moved to a helper file to make it easy to use Jest hasBeenCalledWith. The <code>pluckTitles</code> function checks if the data is available, if the data is not available it returns an empty array. In case the data is available, it loops through each “work” which is a representation of a book, and returns all the titles as an array with an <a href="/blog/2021/03/javascript-array-functions/#map">array map</a>.</p><p>The entry point to this script is at the root in a file named <code>index.js</code>, which looks like the below:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/books'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> titles <span class="token operator">=</span> <span class="token keyword">await</span> books<span class="token punctuation">.</span><span class="token function">getTitlesBySubject</span><span class="token punctuation">(</span><span class="token string">'javascript'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>titles<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The entry point <code>index.js</code> uses an <a href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE">IIFE</a> (Immediately Invoked Function Expression) with async await to call the <code>getTitlesBySubject</code> function on the books module. The IIFE had to be used as Node.js doesn’t have top-level async await yet. When the above <code>index.js</code> is run with <code>node index.js</code> it gives the following output:</p><img class="center" loading="lazy" src="/images/jest-tohavebeencalledwith/02book-titles.jpg" title="Script to fetch book titles from open library API" alt="Script to fetch book titles from open library API"><p>As seen above, the script ran and it pulled the book's titles from the open library API for JavaScript. In the next section, you will learn how to write tests for the above script using Jest with a focus on toHaveBeenCalledWith.</p><h2 id="jest-tests-for-the-script" tabindex="-1">Jest tests for the script <a class="direct-link" href="#jest-tests-for-the-script">#</a></h2><p>Now, you will unit write tests to verify that the app works as expected. In the tests, the HTTP calls to the open library API will be intercepted and a canned response will be used with Jest SpyOn.</p><p>You will learn to add two tests, the first one for the happy path where the API responds without any error. The response can be empty too, for instance, if you search for a subject like <code>nonexistent</code> the API will respond correctly but the date (works array) will be empty as there will be no books for that subject.</p><p>The second test will be for the case where the API responds with an error. For instance, their Cover API doc mentions “only 100 requests/IP are allowed for every 5 minutes.”, if the caller exceeds the limits API will respond with a <code>403 forbidden</code> status. So there will be a test to handle those kinds of scenarios.</p><p>The first test for the happy path is below:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/books'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> helper <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/helper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Books'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'getTitlesBySubject'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should return book titles for given subject'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> javascriptBooksData <span class="token operator">=</span> <span class="token punctuation">{</span><br>        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>          <span class="token literal-property property">ebook_count</span><span class="token operator">:</span> <span class="token number">109</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'/subjects/javascript'</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'javascript'</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">subject_type</span><span class="token operator">:</span> <span class="token string">'subject'</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">work_count</span><span class="token operator">:</span> <span class="token number">109</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">works</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>            <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'/works/OL15180797W'</span><span class="token punctuation">,</span><br>            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'JavaScript: The Good Parts'</span><span class="token punctuation">,</span><br>          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>            <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'/works/OL15180798W'</span><span class="token punctuation">,</span><br>            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'JavaScript: The Definitive Guide'</span><span class="token punctuation">,</span><br>          <span class="token punctuation">}</span><span class="token punctuation">]</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      <br>      <span class="token keyword">const</span> asdfjBooksData <span class="token operator">=</span> <span class="token punctuation">{</span><br>        <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">"/subjects/asdfj"</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"asdfj"</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">subject_type</span><span class="token operator">:</span> <span class="token string">"subject"</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">work_count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">works</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">ebook_count</span><span class="token operator">:</span> <span class="token number">0</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> getSpy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>axios<span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">mockResolvedValueOnce</span><span class="token punctuation">(</span>javascriptBooksData<span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">mockResolvedValueOnce</span><span class="token punctuation">(</span>asdfjBooksData<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> pluckTitlesSpy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>helper<span class="token punctuation">,</span> <span class="token string">'pluckTitles'</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'JavaScript: The Good Parts'</span><span class="token punctuation">,</span> <span class="token string">'JavaScript: The Definitive Guide'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> titles <span class="token operator">=</span> <span class="token keyword">await</span> books<span class="token punctuation">.</span><span class="token function">getTitlesBySubject</span><span class="token punctuation">(</span><span class="token string">'javascript'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">expect</span><span class="token punctuation">(</span>titles<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">expect</span><span class="token punctuation">(</span>titles<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'JavaScript: The Good Parts'</span><span class="token punctuation">,</span> <span class="token string">'JavaScript: The Definitive Guide'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">expect</span><span class="token punctuation">(</span>titles<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>expect<span class="token punctuation">.</span><span class="token function">arrayContaining</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'JavaScript: The Good Parts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token function">expect</span><span class="token punctuation">(</span>getSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">expect</span><span class="token punctuation">(</span>getSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'https://openlibrary.org/subjects/javascript.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">expect</span><span class="token punctuation">(</span>getSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>expect<span class="token punctuation">.</span><span class="token function">stringContaining</span><span class="token punctuation">(</span><span class="token string">'openlibrary.org'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token function">expect</span><span class="token punctuation">(</span>pluckTitlesSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">expect</span><span class="token punctuation">(</span>pluckTitlesSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>expect<span class="token punctuation">.</span><span class="token function">objectContaining</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'javascript'</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">works</span><span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token function">arrayContaining</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>          expect<span class="token punctuation">.</span><span class="token function">objectContaining</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'JavaScript: The Good Parts'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">]</span><span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> noTitles <span class="token operator">=</span> <span class="token keyword">await</span> books<span class="token punctuation">.</span><span class="token function">getTitlesBySubject</span><span class="token punctuation">(</span><span class="token string">'asdfj'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">expect</span><span class="token punctuation">(</span>getSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">expect</span><span class="token punctuation">(</span>getSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenNthCalledWith</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'https://openlibrary.org/subjects/asdfj.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">expect</span><span class="token punctuation">(</span>getSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenLastCalledWith</span><span class="token punctuation">(</span>expect<span class="token punctuation">.</span><span class="token function">stringContaining</span><span class="token punctuation">(</span><span class="token string">'asdfj'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">expect</span><span class="token punctuation">(</span>noTitles<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>It is a relatively big test, still, some extra <code>expects</code> have been added to show the elaborate usage of Jest toHaveBeenCalledWith. First, all three modules are pulled in with require. The system under test is <code>books</code> so the other two modules will be mocked for the unit tests.</p><p>Next, two <code>describes</code> list the module name and the function. Then the test starts with the <code>it</code> function that states <code>should return book titles for the given subject</code> which is our happy path. Notice that in the callback there is an async function as await will be used to call the <code>getTitlesBySubject</code> function.</p><p>After that, the <code>javascriptBooksData</code> const has a mock response for the get books by subjects API for the subject <code>javascript</code>. Similarly, the empty works array is used for the <code>asdfj</code> subject call. The <code>jest.SpyOn</code> with <code>mockResolvedValueOnce</code> will make sure that for the tests the API calls are interjected and a mock response is sent. These calls will never reach the real Open Library API. The <code>mockResolvedValueOnce</code> is used twice as there are two tests in this test, it will be regarded as a bad practice but for the sake of this guide, it will be used.</p><p>Similarly, the <code>pluckTitles</code> function is also spied on to respond with canned values. Consequently the <code>titles</code> constant is set by calling the unit under test <code>books.getTitlesBySubject</code> with <code>javascript</code>. After that, the <code>expects</code> are added to see if the responses are as expected. If the <code>class</code> keyword was used to write the script, <a href="/blog/2022/06/jest-beforeeach/">Jest beforeEach</a> would be useful to test it.</p><p>The focus of this tutorial is on <code>toHaveBeenCalledWith</code>. Next, the usage of toHaveBeenCalledWith for primary data types is covered.</p><h3 id="jest-tohavebeencalledwith-primitive-types" tabindex="-1">Jest toHaveBeenCalledWith primitive types <a class="direct-link" href="#jest-tohavebeencalledwith-primitive-types">#</a></h3><p>To have been called within Jest checks that the function/mock has been called with some defined parameters. It can be used with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#javascript_types">primitive data types</a> like string, integer, etc. For instance:</p><pre class="language-js"><code class="language-js"><span class="token function">expect</span><span class="token punctuation">(</span>getSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'https://openlibrary.org/subjects/javascript.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">expect</span><span class="token punctuation">(</span>getSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>expect<span class="token punctuation">.</span><span class="token function">stringContaining</span><span class="token punctuation">(</span><span class="token string">'openlibrary.org'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Here the get method on Axios is expected to have been called with a string of <code>https://openlibrary.org/subjects/javascript.json</code>. Another way to do it can be to only check part of the string like <code>expect.stringContaining('openlibrary.org');</code> expects the parameter to contain <code>openlibrary.org</code>. It would have also passed if <code>ht/openlibrary.org?a=b</code> was used. You can make the <a href="https://jestjs.io/docs/expect#expectstringcontainingstring">stringContainig</a> checks as strict or lenient as you want.</p><p>If the function has been called more than once then the <code>toHaveBeenNthCalledWith</code> and <code>toHaveBeenLastCalledWith</code> can be used. If the function has been called 3 times and you want to validate the parameters for the second call it will be <code>toHaveBeenNthCalledWith(2, '&lt;your-param-here&gt;')</code> as seen above in the test with the nonexisting subject <code>'asdfj'</code>. Next, you will learn how to test a partial array and object using Jest toHaveBeenCalledWith.</p><h3 id="jest-tohavebeencalledwith-partial-array-and-object" tabindex="-1">Jest toHaveBeenCalledWith partial array and object <a class="direct-link" href="#jest-tohavebeencalledwith-partial-array-and-object">#</a></h3><p>When writing a unit test, you will not just test basic types like string, integer, or boolean. There will be cases where you have to validate arrays and objects (or even custom types/objects). If there is a large object with 20 attributes and for the context of the test only 2 have to be examined then <a href="https://jestjs.io/docs/expect#expectobjectcontainingobject">expect.objectContaining</a> is the right tool for the partial matching task. Similarly, if an array has 10 items and the test checks only one of them, it can be achieved by <a href="https://jestjs.io/docs/expect#expectarraycontainingarray">expect.arrayContaining</a>.</p><p>You can see a relatively complex use of both of them in the above test, as:</p><pre class="language-js"><code class="language-js"><span class="token function">expect</span><span class="token punctuation">(</span>pluckTitlesSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>expect<span class="token punctuation">.</span><span class="token function">objectContaining</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'javascript'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">works</span><span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token function">arrayContaining</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>      expect<span class="token punctuation">.</span><span class="token function">objectContaining</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'JavaScript: The Good Parts'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>So here, the parameter is expected to be an object that has at least a <code>name</code> and <code>works</code> attribute. In the mock it has other properties as well like <code>key</code>, <code>work_count</code> etc, these properties are conveniently ignored as they are not needed for the unit test of the system/unit under test.</p><p>In terms of <code>expect.arrayContaining</code>, for the <code>works</code> property of the parameter, it is expected to be an array. An array that can have many elements but one of them will be an object that has a title of <code>JavaScript: The Good Parts</code>. Even here the other item in the array with the title <code>JavaScript: The Definitive Guide</code> has been deliberately ignored. Also, the <code>key</code> element in the book is also ignored with a partial match as it is not used in the code being tested with <code>objectContaining</code>. Another way to do it is by using <a href="https://jestjs.io/docs/expect#tomatchobjectobject">toMatchObject</a> expect call.</p><h3 id="jest-tohavebeencalledwith-multiple-parameters" tabindex="-1">Jest toHaveBeenCalledWith multiple parameters <a class="direct-link" href="#jest-tohavebeencalledwith-multiple-parameters">#</a></h3><p>By now you have understood how the happy path is tested. Still, there is no test for the edge case error path when the API responds with a response that is not the HTTP 200 response code. Below is the test if the API responds with an error:</p><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should log error if any error occurs while getting books for the given subject'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> getSpy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>axios<span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockRejectedValueOnce</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'too many requests'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> logSpy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> <span class="token string">'log'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementationOnce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> pluckTitlesSpy<span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>helper<span class="token punctuation">,</span> <span class="token string">'pluckTitles'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <br>  <span class="token keyword">const</span> titles <span class="token operator">=</span> <span class="token keyword">await</span> books<span class="token punctuation">.</span><span class="token function">getTitlesBySubject</span><span class="token punctuation">(</span><span class="token string">'javascript'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>pluckTitlesSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>titles<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>getSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>getSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'https://openlibrary.org/subjects/javascript.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">expect</span><span class="token punctuation">(</span>logSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>logSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'Error getting books: too many requests'</span><span class="token punctuation">,</span>       expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></code></pre><p>The test is titled <code>should log error if any error occurs while getting books for the given subject</code> which is self-explanatory. It is an async function similar to the previous test as <code>books.getTitlesBySubject</code> is called with an await to unwrap the promise.</p><p>The other <code>expect</code> calls are pretty similar to the above happy path test case except:</p><pre class="language-js"><code class="language-js"><span class="token function">expect</span><span class="token punctuation">(</span>logSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'Error getting books: too many requests'</span><span class="token punctuation">,</span>       expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This is an example of Jest toHaveBeenCalledWith having more than 1 parameter. For this <code>expect</code> which will cover the <code>console.log</code> writing the error it has 2 parameters. The first one is a string with the exact value <code>Error getting books: too many requests</code>. The second parameter to <code>console.log</code> is expected to be any <code>String</code>.</p><p>Console.log might not be the best option to log messages from your application. You can read the <a href="/blog/2021/01/nodejs-logging-library/">Node.js logging libraries</a> post to have a streamlined logging solution.</p><p>If you run the test with <code>npm test</code> after cloning the <a href="https://github.com/geshan/jest-tohavebeencalledwith/">repository</a> and doing <code>npm install</code> it will render the following output:</p><img class="center" loading="lazy" src="/images/jest-tohavebeencalledwith/03jest-tohavebeencalledwith-run.jpg" title="Jest test run including to have been called with expects" alt="Jest test run including to have been called with expects"><p>You can see that both the tests have run and passed successfully. The tests can be seen as <a href="https://github.com/geshan/jest-tohavebeencalledwith/actions">Github Actions</a> too.</p><p>Great! You have learned how to use Jest toHaveBeenCalledWith covering multiple use cases.</p><h2 id="conclusion" tabindex="-1">Conclusion <a class="direct-link" href="#conclusion">#</a></h2><p>In this tutorial about Jest toHaveBeenCalledWith you learned how to do the partial matching for object properties and array elements. You can also learn about <a href="/blog/2022/07/jest-run-single-test/">running a single jest test</a> easily to target your specific test.</p><p>First, a happy path was covered with tests. Then you wrote a test to verify how the code behaves in an edge case situation. Carry on testing!</p></div><div class="flex items-center justify-between gap-3 md:gap-4 flex-wrap md:flex-nowrap py-2 border-y border-lightbg mt-4"><div class="flex items-center justify-start md:gap-4 gap-2 flex-wrap w-2/3"><div class="flex justify-start items-center gap-3 md:gap-4"><img src="/images/favicons/favicon-32x32-pp.png" alt="Geshan Manandhar" class="w-10 h-10 rounded-full object-cover flex-shrink-0"> <span class="text-gray font-medium font-ui text-md md:text-xl uppercase tracking-wide text-start">Geshan Manandhar</span></div><time datetime="2022-07-29" data-updated="true"><time class="entry-date" datetime="2022-07-29"><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">29-Jul-2022 </span></time></time><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">17 MIN READ</span></div><button type="button" id="share-button-bottom" class="flex items-center justify-center w-8 h-8 md:w-9 md:h-9 rounded text-lightGray hover:border-gray-400 hover:bg-gray-50 transition-colors flex-shrink-0" aria-label="Share this post" onclick="toggleShareIconsBottom(); ga('send', 'event', 'share', 'clickShareOnPost');"><img src="/images/shareIcon.svg" alt="Share this post" class="w-6 h-6"></button></div><div id="share-icons-container-bottom" class="share-icons-bottom print:hidden hidden mx-auto" aria-label="Share this post"><div class="w-full flex items-center justify-center mx-auto gap-3"><span class="share-icons"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" target="_blank" title="Share 'Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects' on LinkedIn" onclick="ga('send', 'event', 'share', 'clickShareOnLinkedIn');"><span id="linkedin-share" class="text-[#0077B5]"><img src="/images/social-icons/linkedin.svg" alt="LinkedIn" class="sharing-common"> </span></a><a href="http://twitter.com/share?text=Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects - &url=https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" target="_blank" title="Share 'Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects' on Twitter" onclick="ga('send', 'event', 'share', 'clickShareOnTwitter');"><span id="twitter-share" class="text-[#1DA1F2]"><img src="/images/social-icons/twitter.svg" alt="Twitter" class="sharing-common"> </span></a><a href="http://www.facebook.com/sharer.php?u=https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" target="_blank" title="Share 'Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects' on Facebook" onclick="ga('send', 'event', 'share', 'clickShareOnFacebook');"><span id="facebook-share" class="text-[#1877F2]"><img src="/images/social-icons/facebook.svg" alt="Facebook" class="sharing-common"> </span></a><a href="https://t.me/share/url?url=https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" target="_blank" title="Share 'Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects' on Telegram" onclick="ga('send', 'event', 'share', 'clickShareOnTelegram');"><span id="telegram-share" class="text-[#0088cc]"><img src="/images/social-icons/telegram.svg" alt="Telegram" class="sharing-common"> </span></a><a href="https://api.whatsapp.com/send?text=https://geshan.com.np/blog/2022/07/jest-tohavebeencalledwith/" target="_blank" title="Share 'Using Jest toHaveBeenCalledWith for testing primitive data types and partial objects' on Whatsapp" onclick="ga('send', 'event', 'share', 'clickShareOnWhatsapp');"><span id="whatsapp-share" class="text-[#25d366]"><img src="/images/social-icons/whatsapp.svg" alt="WhatsApp" class="sharing-common"></span></a></span></div></div></article><div class="mt-3"><a href="/blog/categories/javascript/" title="Javascript" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">javascript </a><a href="/blog/categories/jest/" title="Jest" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">jest </a><a href="/blog/categories/software-engineering/" title="Software Engineering" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">software engineering</a></div><section class="md:w-full mx-auto mt-4"><h3 class="comments font-heading">Comments</h3><div id="disqus_thread"></div><button id="disqus_trigger" class="font-ui text-blackText hover:border-darkAvocado border-blacktext hover:shadow-lg border-2 transition ease-in-out delay-100 px-3 py-2 pt-2 mt-2 rounded-md text-center block h-auto text-xl" onclick="load_disqus()">Post a Comment</button><div id="disqus_thread" aria-live="polite"></div></section></div></div><section class="md:w-full mx-auto mt-4 bg-lightAvocado p-4 rounded-lg pb-8"><div class="max-w-6xl mx-auto md:py-12 px-4"><h2 class="text-4xl text-darkAvocado font-heading font-regular flex-shrink-0 py-8 tracking-normal leading-[105%] md:leading-[105%]"><span class="text-lightGray italic">Related</span> <span class="text-blackText">Blogs</span></h2><div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2024/09/jest-mock-date/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to mock Date in Jest: the easiest way without installing any extra NPM package</a> <time class="font-medium text-xl text-textColor uppercase font-ui">26-Sep-2024 &nbsp;&nbsp;&nbsp; 9 min read</time><p class="text-xl text-gray font-ui">Learn to mock Date in Jest unit test in this simple to follow guide</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2024/07/it.each-jest/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to Use Jest each to Get More Code Coverage with Less Test Code</a> <time class="font-medium text-xl text-textColor uppercase font-ui">06-Jul-2024 &nbsp;&nbsp;&nbsp; 11 min read</time><p class="text-xl text-gray font-ui">Learn how to use it.each with Jest to write less code and stil get more code coverage with data driven test cases.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2022/07/jest-run-single-test/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">Two useful ways to easily run a single test using Jest</a> <time class="font-medium text-xl text-textColor uppercase font-ui">30-Jul-2022 &nbsp;&nbsp;&nbsp; 14 min read</time><p class="text-xl text-gray font-ui">Easily run a single test using Jest with .only or -t CLI paramter. They are also useful to run specific tests.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2022/06/jest-beforeeach/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">Using Jest beforeEach to write better unit tests in JavaScript, with code example</a> <time class="font-medium text-xl text-textColor uppercase font-ui">18-Jun-2022 &nbsp;&nbsp;&nbsp; 13 min read</time><p class="text-xl text-gray font-ui">Learn how to use Jest beforeEach to write better unit tests looking at given practial code example</p></div></div></div></section><section class="bg-avocado md:py-0 py-12 px-4"><div class="max-w-6xl mx-auto"><div class="md:hidden"><h2 class="mb-4 text-3xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-base text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-base text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity w-full text-center">Follow on LinkedIn &nbsp;→</a></div><div class="hidden md:grid lg:hidden grid-cols-3 gap-8 items-center"><div class="z-10 col-span-2"><h2 class="mb-4 text-2xl md:text-4xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-xl text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-xl text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity">Follow on LinkedIn &nbsp;→</a></div><div class="flex items-center justify-end col-span-1"><img class="w-32 h-auto" src="/images/theme/new_logo.svg" alt="Geshan"></div></div><div class="hidden lg:grid grid-cols-2 gap-8 lg:gap-12 items-center justify-between h-full"><div class="z-10"><h2 class="mb-4 text-2xl md:text-4xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-xl text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><p class="text-xl text-blackText font-body font-regular mb-6">A big thank you for supporting this ad. free, unobstructive (no overlays, no pop-ups) blog.</p></div><div class="flex items-center gap-12 w-full md:w-auto justify-end self-end"><img class="w-16 md:w-32 h-auto" src="/images/theme/new_logo.svg" alt="Geshan"> <a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-xl text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity w-full md:w-auto text-center md:text-left">Follow on LinkedIn &nbsp;→</a></div></div></div></section></div></div></div></main><footer role="contentinfo"><footer class="bg-avocado sm:px-4"><div class="max-w-6xl mx-auto flex flex-col md:flex-row sm:flex-col justify-between gap-2 items-center sm:items-center md:items-center py-10 font-nav text-lightGray text-base font-regular"><div class="pb-0 sm:pb-2 text-gray"><span class="pr-4">Copyright © 2026 Geshan Manandhar.</span></div><div class="pb-0 sm:pb-2"><ul class="flex"><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> LinkedIn</a></li><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://www.twitter.com/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> Twitter</a></li><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://github.com/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> Github</a></li></ul></div></div></footer></footer><script src="/js/all.min.js" defer="defer"></script></body></html>