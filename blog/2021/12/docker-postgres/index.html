<!doctype html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta name="author" content="Geshan Manandhar"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Learn how to set up and run PostgreSQL with docker and docker-compose in this step-by-step tutorial. It also shows how to add Postgres to an existing project."><meta name="keywords" content="docker postgres, postgres docker, docker postgresql, postgresql docker"><meta name="p:domain_verify" content="e654c68562abebfa25c291f59d7d00e8"><meta property="og:type" content="website"><meta property="og:url" content="https://geshan.com.np/blog/2021/12/docker-postgres/"><meta property="og:title" content="Postgres with Docker and Docker compose a step-by-step guide for beginners"><meta property="og:description" content="Learn how to set up and run PostgreSQL with docker and docker-compose in this step-by-step tutorial. It also shows how to add Postgres to an existing project."><meta property="og:site_name" content="Geshan&#39;s Blog"><meta property="og:image" content="https://geshan.com.np/images/docker-postgres/01docker-postgres.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:widgets:new-embed-design" content="on"><meta name="twitter:site" content="@geshan"><meta name="twitter:creator" content="@geshan"><meta name="twitter:title" content="Postgres with Docker and Docker compose a step-by-step guide for beginners"><meta name="twitter:description" content="Learn how to set up and run PostgreSQL with docker and docker-compose in this step-by-step tutorial. It also shows how to add Postgres to an existing project."><meta name="twitter:image:src" content="https://geshan.com.np/images/docker-postgres/01docker-postgres.jpg"><link rel="canonical" href="https://geshan.com.np/blog/2021/12/docker-postgres/"><meta property="fb:pages" content="30717799226"><meta property="fb:app_id" content="106030259434380"><meta name="monetization" content="$ilp.uphold.com/aKHWpqhphm9f"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png"><link href="/atom.xml" rel="alternate" title="Geshan&#39;s Blog" type="application/atom+xml"><title>Postgres with Docker and Docker compose a step-by-step guide for beginners</title><link rel="preconnect" href="/" crossorigin><link rel="preload" href="/css/fonts.css" as="style"><link rel="preload" href="/fonts/source-sans-4/source-serif-4-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/source-sans-4/source-serif-4-latin-500-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/source-sans-pro/source-sans-pro-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="/css/fonts.css"><link rel="stylesheet" href="/css/tw-006.css"><link rel="alternate" href="/atom.xml" type="application/atom+xml" title="Geshan&#39;s Blog"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-P3NXCVQEPE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-P3NXCVQEPE');</script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWT2D9T');</script><script src="https://cdn.jsdelivr.net/npm/@statsig/js-client@3/build/statsig-js-client+session-replay+web-analytics.min.js?apikey=client-rYO7rX8WSUyyLg9pKJwymLxM71tCE0CKgxgtUj4akzK"></script><link rel="manifest" href="/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="application-name" content="Geshan.com.np"><meta name="apple-mobile-web-app-title" content="Geshan.com.np"><meta name="msapplication-starturl" content="/index.html"><meta name="theme-color" content="#6947E7"><script>if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/sw.js").then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
        console.log('ServiceWorker registration failed: ', err);
    });
  }</script></head><body class="overflow-x-hidden font-ui flex flex-col min-h-screen"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWT2D9T" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header role="banner"><div><nav class="bg-white" role="navigation"><div class="w-full md:max-w-6xl mx-auto py-4 px-4"><div class="flex items-center justify-between h-16"><div class="flex-shrink-0"><a href="/" class="flex items-center"><img class="h-12 w-12" src="/images/theme/new_logo.svg" alt="Geshan G"></a></div><div class="flex items-center gap-12"><div class="hidden sm:flex items-center gap-12"><a href="/posts/1/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">Posts </a><a href="/about/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">About Me </a><a href="https://newsletter.geshan.com.np/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">Newsletter</a></div><form class="search flex items-center" action="https://www.google.com/search" method="GET"><input type="hidden" name="sitesearch" value="geshan.com.np"><div class="relative"><input class="bg-gray-100 border border-neutralGray rounded-lg py-2 pl-10 pr-4 font-body text-sm focus:outline-none focus:ring-2 focus:ring-avocado focus:border-transparent w-40" type="text" name="q" placeholder="Search" label="search"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-neutralGray" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg></div></form><button type="button" class="sm:hidden inline-flex items-center justify-center p-2 rounded-md text-black focus:outline-none focus:ring-2 focus:ring-inset focus:ring-avocado" onclick="mobileView()" aria-controls="mobile-menu" aria-expanded="false"><span class="sr-only">Open main menu</span> <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button></div></div></div><div class="mobile-menu fixed inset-0 z-40 hidden sm:hidden bg-black bg-opacity-40" role="dialog" aria-modal="true"><div class="absolute inset-0" onclick="mobileView()" aria-hidden="true"></div><div class="mobile-menu-panel relative ml-auto flex h-full w-10/12 max-w-sm flex-col justify-start bg-white shadow-xl"><div class="flex items-center justify-between px-4 py-4 border-b border-gray-200"><div class="flex items-center gap-3"><img class="h-8 w-8" src="/images/theme/new_logo.svg" alt="Geshan G"> <span class="text-lg font-semibold text-textColor font-body">Geshan's Blog</span></div><button type="button" class="inline-flex items-center justify-center rounded-full p-2 text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-avocado" onclick="mobileView()" aria-label="Close main menu"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div><nav class="overflow-y-auto px-4 py-6 space-y-2"><a href="/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Home </a><a href="/posts/1/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Posts </a><a href="/about/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">About Me </a><a href="https://newsletter.geshan.com.np/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Newsletter</a></nav><div class="px 4 py-4 border-t border-gray-200"><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="rounded-lg bg-darkAvocado px-4 py-2 text-base font-regular font-body text-white hover:bg-avocado hover:text-black transition-colors w-2/3 mx-auto ml-4">Connect on LinkedIn</a></div></div></div></nav></div></header><main id="wrap" role="main" class="flex-grow md:px-0"><div id="content"><div class="row"><div><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Geshan&#39;s Blog",
    "alternativeHeadline": "Postgres with Docker and Docker compose a step-by-step guide for beginners",
    "image": "https://geshan.com.np/images/docker-postgres/01docker-postgres.jpg",
    "editor": "Geshan Manandhar",
    "genre": "Software Engineering",
    "keywords": "docker postgres, postgres docker, docker postgresql, postgresql docker",
    "url": "https://geshan.com.np/blog/2021/12/docker-postgres/",
    "datePublished": "2021-12-25",
    "dateCreated": "2021-12-25",
    "dateModified": "2021-12-25",
    "description": "Learn how to set up and run PostgreSQL with docker and docker-compose in this step-by-step tutorial. It also shows how to add Postgres to an existing project.",
    "articleBody": "Docker has shot up in popularity over the years. Postgres (a.k.a PostgreSQL) is an open-source, standards-compliant, and object-relational database been developed for more than 30 years now. This official feature matrix shows the wealth of features Postgres has.Running Postgres with Docker and docker-compose makes it very easy to run and maintain especially in a development environment. In this post, we will look into how to run and use Postgres with Docker and Docker compose step-by-step keeping things simple and easy. Let’s get started!Table of contents #Why use Postgres with docker for local developmentPrerequisitesPostgres with DockerPostgreSQL with docker-composeAdding Postgres with Docker to an existing Node.js projectConclusionWhy use Postgres with docker for local development #There are many good reasons to use any database like Postgres with Docker for local development, below are some good reasons:Using multiple versions of PostgreSQL as per project or any other need is very easy.Generally with docker if it runs on your machine it will run for your friend, on a staging environment and production environment given the version compatibility is maintained.When a new team member joins, the new member can get started in hours, it does not take days to be productive.You can read more about this on why to use docker. In the following section, we will look into some good to have things before diving into the commands to run Postgres with Docker.Prerequisites #Before we dive into some CLI commands and a bit of code below are some prerequisites best to have:Basic knowledge of Docker will be helpful like executing commands like docker run, execute, etc. For this tutorial, docker version 20.10.10 will be used in a Mac.Any prior grasp on Docker compose would be useful but not necessary. For this guide, we will use the docker-compose version 1.29.1 on a Mac.An intermediate understanding of how relational databases work, especially PostgreSQL would be highly beneficial.We will use an existing application/API with Node.js and Postgres replacing a remote Postgres with a local one running with Docker and Docker compose, so it would be advisable to read the previous post about it.Given the prerequisites have been mentioned we can move forward to the next section where we will run some docker commands. Get those itchy fingers ready now.Postgres with Docker #For this post, we will use the official Postgres docker alpine image from DockerHub. We will be using the latest version 14.1 of PostgreSQL.The default bullseye version of Postgres docker image is 130 MB whereas the alpine one for the same version is 78 MB which is a lot smaller.To simply run the container using the Postgres 14.1 alpine image we can execute the following command:docker run --name basic-postgres --rm -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=4y7sV96vA9wv46VR -e PGDATA=/var/lib/postgresql/data/pgdata -v /tmp:/var/lib/postgresql/data -p 5432:5432 -it postgres:14.1-alpineLet’s evaluate what the above command does. It tries to run a container from the posgres:14.1-alpine image which will be pulled in from Dockerhub by default if it does not exist.First, the name  some code  experience clone this Github repository and try it.If Node.js with MySQL is your flavor of choice do read this guide too. You can also try Node.js with SQLite if that works better for you.Conclusion #In this post, we witnessed how to run Postgres with just docker then added the docker-compose goodness to make things easier. After that, we added Postgres to an existing Node.js API to make the local development a lot easier.I hope it makes it easier to understand how to run Postgres with Docker quickly and easily.",
    "author": { "@type": "Person", "name": "Geshan Manandhar" },
    "publisher": {
      "@type": "Organization",
      "name": "Geshan Manandhar",
      "logo": { "@type": "ImageObject", "url": "https://geshan.com.np/images/favicons/favicon-32x32.png" }
    },
    "mainEntityOfPage": { "@type": "WebPage", "@id": "https://geshan.com.np/blog/2021/12/docker-postgres/" }
  }</script><div class="progress-bar"></div><div class="max-w-6xl py-3 mx-auto grid-cols-12 grid gap-15 px-4 md:px-0 mb-20"><div class="col-span-12"><article class="md:w-full mx-auto"><header class="page-header text-center"><h1 class="font-semibold font-heading text-gray text-center mb-6 tracking-[-0.01em] leading-[105%] md:leading-[105%]">Postgres with Docker and Docker compose a step-by-step guide for beginners</h1><div class="flex items-center justify-between gap-3 md:gap-4 flex-wrap md:flex-nowrap py-2 border-y border-lightbg mt-4"><div class="flex items-center justify-start md:gap-4 gap-2 flex-wrap w-2/3"><div class="flex justify-start items-center gap-3 md:gap-4"><img src="/images/favicons/favicon-32x32-pp.png" alt="Geshan Manandhar" class="w-10 h-10 rounded-full object-cover flex-shrink-0"> <span class="text-gray font-medium font-ui text-md md:text-xl uppercase tracking-wide text-start">Geshan Manandhar</span></div><time datetime="2021-12-25" data-updated="true"><time class="entry-date" datetime="2021-12-25"><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">25-Dec-2021 </span></time></time><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">9 MIN READ</span></div><button type="button" id="share-button" class="flex items-center justify-center w-8 h-8 md:w-9 md:h-9 rounded text-lightGray hover:border-gray-400 hover:bg-gray-50 transition-colors flex-shrink-0" aria-label="Share this post" onclick="toggleShareIcons(); ga('send', 'event', 'share', 'clickShareOnPost');"><img src="/images/shareIcon.svg" alt="Share this post" class="w-6 h-6"></button></div><div id="share-icons-container" class="share-icons print:hidden hidden" aria-label="Share this post"><div class="flex items-center justify-center gap-3"><span class="share-icons"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://geshan.com.np/blog/2021/12/docker-postgres/" target="_blank" title="Share 'Postgres with Docker and Docker compose a step-by-step guide for beginners' on LinkedIn" onclick="ga('send', 'event', 'share', 'clickShareOnLinkedIn');"><span id="linkedin-share" class="text-[#0077B5]"><img src="/images/social-icons/linkedin.svg" alt="LinkedIn" class="sharing-common"> </span></a><a href="http://twitter.com/share?text=Postgres with Docker and Docker compose a step-by-step guide for beginners - &url=https://geshan.com.np/blog/2021/12/docker-postgres/" target="_blank" title="Share 'Postgres with Docker and Docker compose a step-by-step guide for beginners' on Twitter" onclick="ga('send', 'event', 'share', 'clickShareOnTwitter');"><span id="twitter-share" class="text-[#1DA1F2]"><img src="/images/social-icons/twitter.svg" alt="Twitter" class="sharing-common"> </span></a><a href="http://www.facebook.com/sharer.php?u=https://geshan.com.np/blog/2021/12/docker-postgres/" target="_blank" title="Share 'Postgres with Docker and Docker compose a step-by-step guide for beginners' on Facebook" onclick="ga('send', 'event', 'share', 'clickShareOnFacebook');"><span id="facebook-share" class="text-[#1877F2]"><img src="/images/social-icons/facebook.svg" alt="Facebook" class="sharing-common"> </span></a><a href="https://t.me/share/url?url=https://geshan.com.np/blog/2021/12/docker-postgres/" target="_blank" title="Share 'Postgres with Docker and Docker compose a step-by-step guide for beginners' on Telegram" onclick="ga('send', 'event', 'share', 'clickShareOnTelegram');"><span id="telegram-share" class="text-[#0088cc]"><img src="/images/social-icons/telegram.svg" alt="Telegram" class="sharing-common"> </span></a><a href="https://api.whatsapp.com/send?text=https://geshan.com.np/blog/2021/12/docker-postgres/" target="_blank" title="Share 'Postgres with Docker and Docker compose a step-by-step guide for beginners' on Whatsapp" onclick="ga('send', 'event', 'share', 'clickShareOnWhatsapp');"><span id="whatsapp-share" class="text-[#25d366]"><img src="/images/social-icons/whatsapp.svg" alt="WhatsApp" class="sharing-common"></span></a></span></div></div></header><div class="entry-content clearfix font-body text-xl text-gray"><p>Docker has shot up in <a href="https://trends.google.com/trends/explore?date=2015-01-01%202021-12-25&amp;q=%2Fm%2F0wkcjgj">popularity over the years</a>. Postgres (a.k.a PostgreSQL) is an open-source, standards-compliant, and object-relational database been developed for more than 30 years now. This official <a href="https://www.postgresql.org/about/featurematrix/">feature matrix</a> shows the wealth of features Postgres has.</p><p>Running Postgres with Docker and docker-compose makes it very easy to run and maintain especially in a development environment. In this post, we will look into how to run and use Postgres with Docker and Docker compose step-by-step keeping things simple and easy. Let’s get started!</p><img class="center" loading="lazy" src="/images/docker-postgres/01docker-postgres.jpg" title="Use Postgres with Docker and docker-compose easily" alt="Use Postgres with Docker and docker-compose easily"><h2 id="table-of-contents" tabindex="-1">Table of contents <a class="direct-link" href="#table-of-contents">#</a></h2><ul><li><a href="#why-use-postgres-with-docker-for-local-development">Why use Postgres with docker for local development</a></li><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#postgres-with-docker">Postgres with Docker</a></li><li><a href="#postgresql-with-docker-compose">PostgreSQL with docker-compose</a></li><li><a href="#adding-postgres-with-docker-to-an-existing-nodejs-project">Adding Postgres with Docker to an existing Node.js project</a></li><li><a href="#conclusion">Conclusion</a></li></ul><h2 id="why-use-postgres-with-docker-for-local-development" tabindex="-1">Why use Postgres with docker for local development <a class="direct-link" href="#why-use-postgres-with-docker-for-local-development">#</a></h2><p>There are many good reasons to use any database like Postgres with Docker for local development, below are some good reasons:</p><ol><li>Using multiple versions of PostgreSQL as per project or any other need is very easy.</li><li>Generally with docker if it runs on your machine it will run for your friend, on a staging environment and production environment given the version compatibility is maintained.</li><li>When a new team member joins, the new member can get started in hours, it does not take days to be productive.</li></ol><p>You can read more about this on <a href="/blog/2018/10/why-use-docker-3-reasons-from-a-development-perspective/">why to use docker</a>. In the following section, we will look into some good to have things before diving into the commands to run Postgres with Docker.</p><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="direct-link" href="#prerequisites">#</a></h2><p>Before we dive into some CLI commands and a bit of code below are some prerequisites best to have:</p><ol><li>Basic knowledge of Docker will be helpful like executing commands like docker run, execute, etc. For this tutorial, docker version 20.10.10 will be used in a Mac.</li><li>Any prior grasp on Docker compose would be useful but not necessary. For this guide, we will use the docker-compose version 1.29.1 on a Mac.</li><li>An intermediate understanding of how relational databases work, especially PostgreSQL would be highly beneficial.</li><li>We will use an existing application/API with <a href="/blog/2021/01/nodejs-postgresql-tutorial/">Node.js and Postgres</a> replacing a remote Postgres with a local one running with Docker and Docker compose, so it would be advisable to read the previous post about it.</li></ol><p>Given the prerequisites have been mentioned we can move forward to the next section where we will run some <a href="/blog/2022/05/docker-commands/">docker commands</a>. Get those itchy fingers ready now.</p><h2 id="postgres-with-docker" tabindex="-1">Postgres with Docker <a class="direct-link" href="#postgres-with-docker">#</a></h2><p>For this post, we will use the official Postgres docker alpine image from <a href="https://hub.docker.com/_/postgres">DockerHub</a>. We will be using the latest version 14.1 of PostgreSQL.</p><p>The default bullseye version of Postgres docker image is 130 MB whereas the alpine one for the same version is 78 MB which is a lot smaller.</p><p>To simply run the container using the Postgres 14.1 alpine image we can execute the following command:</p><pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> basic-postgres <span class="token parameter variable">--rm</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">POSTGRES_USER</span><span class="token operator">=</span>postgres <span class="token parameter variable">-e</span> <span class="token assign-left variable">POSTGRES_PASSWORD</span><span class="token operator">=</span>4y7sV96vA9wv46VR <span class="token parameter variable">-e</span> <span class="token assign-left variable">PGDATA</span><span class="token operator">=</span>/var/lib/postgresql/data/pgdata <span class="token parameter variable">-v</span> /tmp:/var/lib/postgresql/data <span class="token parameter variable">-p</span> <span class="token number">5432</span>:5432 <span class="token parameter variable">-it</span> postgres:14.1-alpine</code></pre><p>Let’s evaluate what the above command does. It tries to run a container from the posgres:14.1-alpine image which will be pulled in from Dockerhub by default if it does not exist.</p><p>First, the name <code>basic-posgres</code> is given to the running container, and <code>--rm</code> will clean up the container and remove the file system when the container exits. Some environment variables have been added to make things easier.</p><p>The last 3 parameters are interesting, <code>-v</code> adds a volume to store data, for this example, it has been mapped to <code>/tmp</code> so all data will be lost when the machine restarts. Next, we use the <code>-p</code> parameter to map the host port 5432 to the container port 5432.</p><p>The last parameter to the command is <code>-it</code> to have the tty available. When we run the command we will see an output like the below:</p><img class="center" loading="lazy" src="/images/docker-postgres/02docker-run-postgres.jpg" title="Run PostgreSQL with just docker run" alt="Run PostgreSQL with just docker run"><p>The container is running and ready to accept connections, if we run the following command we can go inside the container and run the <code>psql</code> command to see the <code>postgres</code> database which is the same as the username supplied in the event variable.</p><pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> basic-postgres /bin/sh</code></pre><p>After we are inside the container we can run <code>psql --username postgres</code> to access the Postgres CLI. To list the databases we can run <code>\l</code> inside the psql CLI to list the databases and see the Postgres database as seen below:</p><img class="center" loading="lazy" src="/images/docker-postgres/03docker-exec-postgres.jpg" title="Docker exec in Postgres and list the databases" alt="Docker exec in Postgres and list the databases"><p>As seen in the above picture <code>\q</code> will quit the psql CLI and exit the container’s shell we have ran <code>exit</code>.</p><p>If we go back to the running container and hit <code>Ctrl+C</code> it will stop the container as well as clean it up as we have used the <code>--rm</code> parameter when we ran it.</p><p>This is a way to run Postgres with docker but as we have seen it is not easy to remember the 10 liner command and all the needed parameters.</p><p>Also, we have not specified any link between the database and our application. This is where the docker-compose file and <a href="https://docs.docker.com/compose/">docker-compose</a> command comes in very handy as seen in the next section.</p><h2 id="postgresql-with-docker-compose" tabindex="-1">PostgreSQL with docker-compose <a class="direct-link" href="#postgresql-with-docker-compose">#</a></h2><p>To run the same Postgres 14.1-alpine with docker-compose we will create a <code>docker-compose-pg-only.yml</code> file with the following contents:</p><pre class="language-bash"><code class="language-bash">version: <span class="token string">'3.8'</span><br>services:<br>  db:<br>    image: postgres:14.1-alpine<br>    restart: always<br>    environment:<br>      - <span class="token assign-left variable">POSTGRES_USER</span><span class="token operator">=</span>postgres<br>      - <span class="token assign-left variable">POSTGRES_PASSWORD</span><span class="token operator">=</span>postgres<br>    ports:<br>      - <span class="token string">'5432:5432'</span><br>    volumes: <br>      - db:/var/lib/postgresql/data<br>volumes:<br>  db:<br>    driver: <span class="token builtin class-name">local</span></code></pre><p>The docker-compose file has the following things to consider:</p><ol><li>It uses the docker-compose file <a href="https://docs.docker.com/compose/compose-file/compose-file-v3/">version 3.8</a></li><li>Next up, we define <code>db</code> as a <a href="https://docs.docker.com/compose/compose-file/compose-file-v3/#service-configuration-reference">service</a>, each service will equate to a new <code>docker run</code> command</li><li>We are asking docker-compose for the service to be an image of Postgres version 14.1 alpine which will always restart if the container stops automatically.</li><li>Consequently we define two environment variables to send in the Postgres user and password. Keep in mind, as the database is not sent by default for the official image it will use the username as the database name.</li><li>Subsequently we map the host/machine port <code>5432</code> with the container port <code>5432</code> as Postgres runs in that port in the container.</li><li>After that we ask docker-compose to manage the <a href="https://docs.docker.com/compose/compose-file/compose-file-v3/#volumes">volume</a> in a name called <code>db</code> which is further added to be a local driver. So when the container is restarted the data will be available from docker managed volume. To see the contents of the volume we can run <code>docker volume ls</code> and inspect the volume attached to our Postgres container.</li></ol><p>After that explanation, to start the containers we will run <code>docker-compose -f docker-compose-pg-only.yml up</code> which will show an output like below:</p><img class="center" loading="lazy" src="/images/docker-postgres/04docker-compose-up-postgres-only.jpg" title="Output of docker-compose up for Postgres container" alt="Output of docker-compose up for Postgres container"><p>So the Postgres database is running and this time it was a one-line command, not a long command to get it running as all the needed parameters were in the docker-compose file.</p><p>At this point, the Postgres in the container will behave similarly to a local Postgres instance as we have mapped the port <code>5432</code> to the local port <code>5432</code>.</p><p>Next up, we will see how we modify the docker-compose file to fit in an existing project.</p><h2 id="adding-postgres-with-docker-to-an-existing-node.js-project" tabindex="-1">Adding Postgres with Docker to an existing Node.js project <a class="direct-link" href="#adding-postgres-with-docker-to-an-existing-node.js-project">#</a></h2><p>Given we have seen PostgreSQL run with docker-compose, now we will integrate it with a running Node.js API project. A full step-by-step tutorial of how this Quotes API project is built with <a href="/blog/2021/01/nodejs-postgresql-tutorial/">Node.js and Postgres</a> is available for your reference. For this guide we will add a <code>docker-compose.yml</code> file with the following contents:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">version: <span class="token string">'3.8'</span></span><br><span class="highlight-line">services:</span><br><span class="highlight-line">  db:</span><br><span class="highlight-line">    image: postgres:14.1-alpine</span><br><span class="highlight-line">    restart: always</span><br><span class="highlight-line">    environment:</span><br><span class="highlight-line">      - <span class="token assign-left variable">POSTGRES_USER</span><span class="token operator">=</span>postgres</span><br><span class="highlight-line">      - <span class="token assign-left variable">POSTGRES_PASSWORD</span><span class="token operator">=</span>postgres</span><br><span class="highlight-line">    ports:</span><br><span class="highlight-line">      - <span class="token string">'5432:5432'</span></span><br><span class="highlight-line">    volumes: </span><br><span class="highlight-line">      - db:/var/lib/postgresql/data</span><br><mark class="highlight-line highlight-line-active">      - ./db/init.sql:/docker-entrypoint-initdb.d/create_tables.sql</mark><br><span class="highlight-line">  api:</span><br><span class="highlight-line">    container_name: quotes-api</span><br><span class="highlight-line">    build:</span><br><span class="highlight-line">      context: ./</span><br><span class="highlight-line">      target: production</span><br><span class="highlight-line">    image: quotes-api</span><br><span class="highlight-line">    depends_on:</span><br><span class="highlight-line">      - db</span><br><span class="highlight-line">    ports:</span><br><span class="highlight-line">      - <span class="token number">3000</span>:3000</span><br><span class="highlight-line">    environment:</span><br><span class="highlight-line">      NODE_ENV: production</span><br><span class="highlight-line">      DB_HOST: db</span><br><span class="highlight-line">      DB_PORT: <span class="token number">5432</span></span><br><span class="highlight-line">      DB_USER: postgres</span><br><span class="highlight-line">      DB_PASSWORD: postgres</span><br><span class="highlight-line">      DB_NAME: postgres</span><br><span class="highlight-line">    links:</span><br><span class="highlight-line">      - db</span><br><span class="highlight-line">    volumes:</span><br><span class="highlight-line">      - <span class="token string">'./:/src'</span></span><br><span class="highlight-line">volumes:</span><br><span class="highlight-line">  db:</span><br><span class="highlight-line">    driver: <span class="token builtin class-name">local</span></span></code></pre><p>This file looks somewhat similar to the above docker-compose file but below are the main differences.</p><p>The first one is, here we use <code>- ./db/init.sql:/docker-entrypoint-initdb.d/create_tables.sql</code> on line number 13. We are doing this to create the <code>quotes</code> table and fill up the data as seen in this <a href="https://github.com/geshan/nodejs-posgresql/blob/master/db/init.sql">SQL file</a>. This is the way to run <a href="https://github.com/docker-library/docs/tree/master/postgres#initialization-scripts">initialization scripts</a> for Postgres with docker. This is an idempotent operation, if the data directory is filled up the <code>init.sql</code> file won't be executed again to prevent data overriding. If we want to force override the data we will need to delete the docker volume after a <code>docker volume inspect</code>.</p><p>Next, we define a new service called <code>api</code> which builds the local <code>Dockerfile</code> with target <code>production</code> and names it <code>quotes-api</code>. After that, it has a <code>depends_on</code> definition on the <code>db</code> container which is our Postgres container.</p><p>Subsequently, it maps the host port 3000 to the exposed container port 3000 where the Node.js Express API server is running. In the environment variables, it defines <code>db</code> as the host which maps to the above Postgres container and uses the same credentials as provided in the above definition. It <a href="https://docs.docker.com/compose/compose-file/compose-file-v3/#links">links</a> to the Postgres container defined before the API service. You should learn more about <a href="/blog/2023/08/docker-compose-environment-variables/">docker compose environment variables</a>.</p><p>Finally, it maps all the local files to the <code>/src</code> of the container to make things run with Node.js.</p><p>This file is available on <a href="https://github.com/geshan/nodejs-posgresql/pull/25/files#diff-e45e45baeda1c1e73482975a664062aa56f20c03dd9d64a827aba57775bed0d3R1">GitHub</a> too for your reference.</p><p>When we run docker-compose up on the root of this project we can see the following output:</p><img class="center" loading="lazy" src="/images/docker-postgres/05docker-compose-up-postgres-and-nodejs.jpg" title="Output of docker-compose up for Postgres and Node.js Express containers" alt="Output of docker-compose up for Postgres and Node.js Express containers"><p>As the webserver is mapped to the local port 3000, we can see the output as below when hitting <code>http://locahost:3000/quotes</code> on any browser:</p><img class="center" loading="lazy" src="/images/docker-postgres/06quotes-api-working-with-dockerized-postgres.jpg" title="Quotes API working with Dockerized Node.js and PostgreSQL using docker-compose" alt="Quotes API working with Dockerized Node.js and PostgreSQL using docker-compose"><p>Hurray! Our Node.js Express API for Quotes is communicating correctly with the local Postgresql database as expected. If you want to quickly try the <code>docker-compose up</code> experience clone this <a href="https://github.com/geshan/nodejs-posgresql">Github repository</a> and try it.</p><p>If <a href="/blog/2020/11/nodejs-mysql-tutorial/">Node.js with MySQL</a> is your flavor of choice do read this guide too. You can also try <a href="/blog/2021/10/nodejs-sqlite/">Node.js with SQLite</a> if that works better for you.</p><h2 id="conclusion" tabindex="-1">Conclusion <a class="direct-link" href="#conclusion">#</a></h2><p>In this post, we witnessed how to run Postgres with just docker then added the docker-compose goodness to make things easier. After that, we added Postgres to an existing Node.js API to make the local development a lot easier.</p><blockquote><p>I hope it makes it easier to understand how to run Postgres with Docker quickly and easily.</p></blockquote></div><div class="flex items-center justify-between gap-3 md:gap-4 flex-wrap md:flex-nowrap py-2 border-y border-lightbg mt-4"><div class="flex items-center justify-start md:gap-4 gap-2 flex-wrap w-2/3"><div class="flex justify-start items-center gap-3 md:gap-4"><img src="/images/favicons/favicon-32x32-pp.png" alt="Geshan Manandhar" class="w-10 h-10 rounded-full object-cover flex-shrink-0"> <span class="text-gray font-medium font-ui text-md md:text-xl uppercase tracking-wide text-start">Geshan Manandhar</span></div><time datetime="2021-12-25" data-updated="true"><time class="entry-date" datetime="2021-12-25"><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">25-Dec-2021 </span></time></time><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">9 MIN READ</span></div><button type="button" id="share-button-bottom" class="flex items-center justify-center w-8 h-8 md:w-9 md:h-9 rounded text-lightGray hover:border-gray-400 hover:bg-gray-50 transition-colors flex-shrink-0" aria-label="Share this post" onclick="toggleShareIconsBottom(); ga('send', 'event', 'share', 'clickShareOnPost');"><img src="/images/shareIcon.svg" alt="Share this post" class="w-6 h-6"></button></div><div id="share-icons-container-bottom" class="share-icons-bottom print:hidden hidden mx-auto" aria-label="Share this post"><div class="w-full flex items-center justify-center mx-auto gap-3"><span class="share-icons"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://geshan.com.np/blog/2021/12/docker-postgres/" target="_blank" title="Share 'Postgres with Docker and Docker compose a step-by-step guide for beginners' on LinkedIn" onclick="ga('send', 'event', 'share', 'clickShareOnLinkedIn');"><span id="linkedin-share" class="text-[#0077B5]"><img src="/images/social-icons/linkedin.svg" alt="LinkedIn" class="sharing-common"> </span></a><a href="http://twitter.com/share?text=Postgres with Docker and Docker compose a step-by-step guide for beginners - &url=https://geshan.com.np/blog/2021/12/docker-postgres/" target="_blank" title="Share 'Postgres with Docker and Docker compose a step-by-step guide for beginners' on Twitter" onclick="ga('send', 'event', 'share', 'clickShareOnTwitter');"><span id="twitter-share" class="text-[#1DA1F2]"><img src="/images/social-icons/twitter.svg" alt="Twitter" class="sharing-common"> </span></a><a href="http://www.facebook.com/sharer.php?u=https://geshan.com.np/blog/2021/12/docker-postgres/" target="_blank" title="Share 'Postgres with Docker and Docker compose a step-by-step guide for beginners' on Facebook" onclick="ga('send', 'event', 'share', 'clickShareOnFacebook');"><span id="facebook-share" class="text-[#1877F2]"><img src="/images/social-icons/facebook.svg" alt="Facebook" class="sharing-common"> </span></a><a href="https://t.me/share/url?url=https://geshan.com.np/blog/2021/12/docker-postgres/" target="_blank" title="Share 'Postgres with Docker and Docker compose a step-by-step guide for beginners' on Telegram" onclick="ga('send', 'event', 'share', 'clickShareOnTelegram');"><span id="telegram-share" class="text-[#0088cc]"><img src="/images/social-icons/telegram.svg" alt="Telegram" class="sharing-common"> </span></a><a href="https://api.whatsapp.com/send?text=https://geshan.com.np/blog/2021/12/docker-postgres/" target="_blank" title="Share 'Postgres with Docker and Docker compose a step-by-step guide for beginners' on Whatsapp" onclick="ga('send', 'event', 'share', 'clickShareOnWhatsapp');"><span id="whatsapp-share" class="text-[#25d366]"><img src="/images/social-icons/whatsapp.svg" alt="WhatsApp" class="sharing-common"></span></a></span></div></div></article><div class="mt-3"><a href="/blog/categories/software-engineering/" title="Software Engineering" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">software engineering </a><a href="/blog/categories/docker/" title="Docker" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">docker </a><a href="/blog/categories/postgres/" title="Postgres" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">postgres</a></div><section class="md:w-full mx-auto mt-4"><h3 class="comments font-heading">Comments</h3><div id="disqus_thread"></div><button id="disqus_trigger" class="font-ui text-blackText hover:border-darkAvocado border-blacktext hover:shadow-lg border-2 transition ease-in-out delay-100 px-3 py-2 pt-2 mt-2 rounded-md text-center block h-auto text-xl" onclick="load_disqus()">Post a Comment</button><div id="disqus_thread" aria-live="polite"></div></section></div></div><section class="md:w-full mx-auto mt-4 bg-lightAvocado p-4 rounded-lg pb-8"><div class="max-w-6xl mx-auto md:py-12 px-4"><h2 class="text-4xl text-darkAvocado font-heading font-regular flex-shrink-0 py-8 tracking-normal leading-[105%] md:leading-[105%]"><span class="text-lightGray italic">Related</span> <span class="text-blackText">Blogs</span></h2><div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2024/12/postgres-insert-on-conflict-update/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to Upsert Data in Postgres Using INSERT ON CONFLICT UPDATE</a> <time class="font-medium text-xl text-textColor uppercase font-ui">14-Dec-2024 &nbsp;&nbsp;&nbsp; 9 min read</time><p class="text-xl text-gray font-ui">Learn how to upsert data in Postgres using the INSERT ON CONFLICT UPDATE clause with practical examples. Combine insert and update operations into one UPSERT.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2024/08/postgres-insert-multiple-rows/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to insert multiple rows in Postgres using two useful methods</a> <time class="font-medium text-xl text-textColor uppercase font-ui">14-Aug-2024 &nbsp;&nbsp;&nbsp; 10 min read</time><p class="text-xl text-gray font-ui">Learn to insert multiple rows at once in Postgres with a single insert statement and the copy command in this useful tutorial.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2024/05/postgres-rename-column/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to rename a column in Postgres, from a simple to a real-life example</a> <time class="font-medium text-xl text-textColor uppercase font-ui">26-May-2024 &nbsp;&nbsp;&nbsp; 7 min read</time><p class="text-xl text-gray font-ui">Learn how to rename a column in Postgres from a simple alter table rename column to a zero downtime real-life example.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2024/05/rabbitmq-docker/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to use RabbitMQ with Docker and Docker Compose; a beginner’s guide</a> <time class="font-medium text-xl text-textColor uppercase font-ui">08-May-2024 &nbsp;&nbsp;&nbsp; 6 min read</time><p class="text-xl text-gray font-ui">Learn how to run Rabbitmq with docker and docker compose in this useful tutorial.</p></div></div></div></section><section class="bg-avocado md:py-0 py-12 px-4"><div class="max-w-6xl mx-auto"><div class="md:hidden"><h2 class="mb-4 text-3xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-base text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-base text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity w-full text-center">Follow on LinkedIn &nbsp;→</a></div><div class="hidden md:grid lg:hidden grid-cols-3 gap-8 items-center"><div class="z-10 col-span-2"><h2 class="mb-4 text-2xl md:text-4xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-xl text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-xl text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity">Follow on LinkedIn &nbsp;→</a></div><div class="flex items-center justify-end col-span-1"><img class="w-32 h-auto" src="/images/theme/new_logo.svg" alt="Geshan"></div></div><div class="hidden lg:grid grid-cols-2 gap-8 lg:gap-12 items-center justify-between h-full"><div class="z-10"><h2 class="mb-4 text-2xl md:text-4xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-xl text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><p class="text-xl text-blackText font-body font-regular mb-6">A big thank you for supporting this ad. free, unobstructive (no overlays, no pop-ups) blog.</p></div><div class="flex items-center gap-12 w-full md:w-auto justify-end self-end"><img class="w-16 md:w-32 h-auto" src="/images/theme/new_logo.svg" alt="Geshan"> <a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-xl text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity w-full md:w-auto text-center md:text-left">Follow on LinkedIn &nbsp;→</a></div></div></div></section></div></div></div></main><footer role="contentinfo"><footer class="bg-avocado sm:px-4"><div class="max-w-6xl mx-auto flex flex-col md:flex-row sm:flex-col justify-between gap-2 items-center sm:items-center md:items-center py-10 font-nav text-lightGray text-base font-regular"><div class="pb-0 sm:pb-2 text-gray"><span class="pr-4">Copyright © 2026 Geshan Manandhar.</span></div><div class="pb-0 sm:pb-2"><ul class="flex"><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> LinkedIn</a></li><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://www.twitter.com/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> Twitter</a></li><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://github.com/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> Github</a></li></ul></div></div></footer></footer><script src="/js/all.min.js" defer="defer"></script></body></html>