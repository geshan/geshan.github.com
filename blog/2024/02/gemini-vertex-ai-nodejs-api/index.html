<!doctype html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta name="author" content="Geshan Manandhar"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Learn how to create a simple summarizer with Gemini API on Vertex AI with Node.js that runs on the CLI."><meta name="keywords" content="Gemini, Gemini api, vertex ai, gemini node.js, vertex ai nodejs, vertex ai node.js, google gemini, gemini pro nodejs"><meta name="p:domain_verify" content="e654c68562abebfa25c291f59d7d00e8"><meta property="og:type" content="website"><meta property="og:url" content="https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/"><meta property="og:title" content="How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]"><meta property="og:description" content="Learn how to create a simple summarizer with Gemini API on Vertex AI with Node.js that runs on the CLI."><meta property="og:site_name" content="Geshan&#39;s Blog"><meta property="og:image" content="https://geshan.com.np/images/gemini-vertex-ai-nodejs-api/01gemini-vertex-ai-nodejs-api.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:widgets:new-embed-design" content="on"><meta name="twitter:site" content="@geshan"><meta name="twitter:creator" content="@geshan"><meta name="twitter:title" content="How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]"><meta name="twitter:description" content="Learn how to create a simple summarizer with Gemini API on Vertex AI with Node.js that runs on the CLI."><meta name="twitter:image:src" content="https://geshan.com.np/images/gemini-vertex-ai-nodejs-api/01gemini-vertex-ai-nodejs-api.jpg"><link rel="canonical" href="https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/"><meta property="fb:pages" content="30717799226"><meta property="fb:app_id" content="106030259434380"><meta name="monetization" content="$ilp.uphold.com/aKHWpqhphm9f"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png"><link href="/atom.xml" rel="alternate" title="Geshan&#39;s Blog" type="application/atom+xml"><title>How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]</title><link rel="preconnect" href="/" crossorigin><link rel="preload" href="/css/fonts.css" as="style"><link rel="preload" href="/fonts/source-sans-4/source-serif-4-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/source-sans-4/source-serif-4-latin-500-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/source-sans-pro/source-sans-pro-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="/css/fonts.css"><link rel="stylesheet" href="/css/tw-006.css"><link rel="alternate" href="/atom.xml" type="application/atom+xml" title="Geshan&#39;s Blog"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-P3NXCVQEPE"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-P3NXCVQEPE');</script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWT2D9T');</script><script src="https://cdn.jsdelivr.net/npm/@statsig/js-client@3/build/statsig-js-client+session-replay+web-analytics.min.js?apikey=client-rYO7rX8WSUyyLg9pKJwymLxM71tCE0CKgxgtUj4akzK"></script><link rel="manifest" href="/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="application-name" content="Geshan.com.np"><meta name="apple-mobile-web-app-title" content="Geshan.com.np"><meta name="msapplication-starturl" content="/index.html"><meta name="theme-color" content="#6947E7"><script>if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/sw.js").then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
        console.log('ServiceWorker registration failed: ', err);
    });
  }</script></head><body class="overflow-x-hidden font-ui flex flex-col min-h-screen"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWT2D9T" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header role="banner"><div><nav class="bg-white" role="navigation"><div class="w-full md:max-w-6xl mx-auto py-4 px-4"><div class="flex items-center justify-between h-16"><div class="flex-shrink-0"><a href="/" class="flex items-center"><img class="h-12 w-12" src="/images/theme/new_logo.svg" alt="Geshan G"></a></div><div class="flex items-center gap-12"><div class="hidden sm:flex items-center gap-12"><a href="/posts/1/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">Posts </a><a href="/about/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">About Me </a><a href="https://newsletter.geshan.com.np/" class="uppercase text-base font-ui font-medium text-gray hover:text-midgrey transition-colors" aria-current="page">Newsletter</a></div><form class="search flex items-center" action="https://www.google.com/search" method="GET"><input type="hidden" name="sitesearch" value="geshan.com.np"><div class="relative"><input class="bg-gray-100 border border-neutralGray rounded-lg py-2 pl-10 pr-4 font-body text-sm focus:outline-none focus:ring-2 focus:ring-avocado focus:border-transparent w-40" type="text" name="q" placeholder="Search" label="search"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-neutralGray" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg></div></form><button type="button" class="sm:hidden inline-flex items-center justify-center p-2 rounded-md text-black focus:outline-none focus:ring-2 focus:ring-inset focus:ring-avocado" onclick="mobileView()" aria-controls="mobile-menu" aria-expanded="false"><span class="sr-only">Open main menu</span> <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button></div></div></div><div class="mobile-menu fixed inset-0 z-40 hidden sm:hidden bg-black bg-opacity-40" role="dialog" aria-modal="true"><div class="absolute inset-0" onclick="mobileView()" aria-hidden="true"></div><div class="mobile-menu-panel relative ml-auto flex h-full w-10/12 max-w-sm flex-col justify-start bg-white shadow-xl"><div class="flex items-center justify-between px-4 py-4 border-b border-gray-200"><div class="flex items-center gap-3"><img class="h-8 w-8" src="/images/theme/new_logo.svg" alt="Geshan G"> <span class="text-lg font-semibold text-textColor font-body">Geshan's Blog</span></div><button type="button" class="inline-flex items-center justify-center rounded-full p-2 text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-avocado" onclick="mobileView()" aria-label="Close main menu"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div><nav class="overflow-y-auto px-4 py-6 space-y-2"><a href="/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Home </a><a href="/posts/1/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Posts </a><a href="/about/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">About Me </a><a href="https://newsletter.geshan.com.np/" class="block rounded-lg px-3 py-2 text-base font-medium font-ui text-black hover:bg-lightAvocado" aria-current="page">Newsletter</a></nav><div class="px 4 py-4 border-t border-gray-200"><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="rounded-lg bg-darkAvocado px-4 py-2 text-base font-regular font-body text-white hover:bg-avocado hover:text-black transition-colors w-2/3 mx-auto ml-4">Connect on LinkedIn</a></div></div></div></nav></div></header><main id="wrap" role="main" class="flex-grow md:px-0"><div id="content"><div class="row"><div><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Geshan&#39;s Blog",
    "alternativeHeadline": "How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]",
    "image": "https://geshan.com.np/images/gemini-vertex-ai-nodejs-api/01gemini-vertex-ai-nodejs-api.jpg",
    "editor": "Geshan Manandhar",
    "genre": "AI",
    "keywords": "Gemini, Gemini api, vertex ai, gemini node.js, vertex ai nodejs, vertex ai node.js, google gemini, gemini pro nodejs",
    "url": "https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/",
    "datePublished": "2024-02-22",
    "dateCreated": "2024-02-22",
    "dateModified": "2024-02-22",
    "description": "Learn how to create a simple summarizer with Gemini API on Vertex AI with Node.js that runs on the CLI.",
    "articleBody": "Gemini by Google is a powerful LLM and in this tutorial, you will use the Gemini Pro 1.0 version to summarize text from a URL. In the previous part you learned how to set up a GCP project, try out the prompt on Vertex AI studio and then try to code on the CLI. In this part, you will refactor and converter that code to take in a URL, scrape its content, and use it to create the summary, let&#39;s get going!Table of contents #Where we left in the last partBuild the Node.js APICreate gemini.js fileAdd scraper.js fileNew cli.jsBuild the Express.js APIConclusionWhere we left in the last part #From the last part, you have a folder called  some code  file):const { VertexAI } = require(&#39;@google-cloud/vertexai&#39;);const vertex_ai = new VertexAI({ project: &#39;gemini-api-414910&#39;, location: &#39;us-central1&#39; });const model = &#39;gemini-pro&#39;;const generativeModel = vertex_ai.preview.getGenerativeModel({  model: model,  generation_config: {    &quot;max_output_tokens&quot;: 2048,    &quot;temperature&quot;: 0.9,    &quot;top_p&quot;: 1  },  safety_settings: [    {      &quot;category&quot;: &quot;HARM_CATEGORY_HATE_SPEECH&quot;,      &quot;threshold&quot;: &quot;BLOCK_MEDIUM_AND_ABOVE&quot;    },    {      &quot;category&quot;: &quot;HARM_CATEGORY_DANGEROUS_CONTENT&quot;,      &quot;threshold&quot;: &quot;BLOCK_MEDIUM_AND_ABOVE&quot;    },    {      &quot;category&quot;: &quot;HARM_CATEGORY_SEXUALLY_EXPLICIT&quot;,      &quot;threshold&quot;: &quot;BLOCK_MEDIUM_AND_ABOVE&quot;    },    {      &quot;category&quot;: &quot;HARM_CATEGORY_HARASSMENT&quot;,      &quot;threshold&quot;: &quot;BLOCK_MEDIUM_AND_ABOVE&quot;    }  ],});async function getSummary(text) {  const prompt = &#39;As an expert writer with more than a decade of experience please summarize the following in under 125 words words. You are allowed to rephrase given the summary means the same as the original text:&#92;n&#92;n&#39;;  const req = {    contents: [{ role: &#39;user&#39;, parts: [{ text: `${prompt}${text}` }] }],  };  const resp = await generativeModel.generateContent(req);  const summary = resp.response?.candidates[0]?.content?.parts[0]?.text;  return summary;};module.exports = {  getSummary}The things that have changed here is, that you have renamed the  some code  will look like the below:const scraper = require(&#39;./scraper&#39;);const summaryGenerator = require(&#39;./gemini&#39;);(async () =&gt; {  const url = process.argv[2] || &#39;https://7news.com.au/news/travellers-arriving-in-nsw-urged-to-check-luggage-for-unwanted-stowaway-c-13642953&#39;;  console.log(`Getting summary for url: ${url} &#92;n`);  const pageContents = await scraper.getContents(url);  if (pageContents.length === 0) {    return &#39;Could not get data from the given URL&#39;;  }  console.log(await summaryGenerator.getSummary(pageContents));})();Here, you first require the  some code  on the root with the following contents:const express = require(&#39;express&#39;);const scraper = require(&#39;./scraper&#39;);const summaryGenerator = require(&#39;./gemini&#39;);const app = express();const port = process.env.PORT || &#39;3000&#39;;app.get(&#39;/&#39;, (req, res) =&gt; {  res.json({ message: &#39;alive&#39; });});app.get(&#39;/summary&#39;, async (req, res) =&gt; {  const url = req.query?.url || &#39;https://7news.com.au/news/travellers-arriving-in-nsw-urged-to-check-luggage-for-unwanted-stowaway-c-13642953&#39;;  try {    new URL(url); //validates if given string is a valid URL  } catch (err) {    return res.status(400).json({message: `provider URL ${url} is not a valid URL`});  }  console.log(`Getting summary for url: ${url} &#92;n`);  const pageContents = await scraper.getContents(url);  if (pageContents.length === 0) {    return res.status(501).json({message: &#39;Could not get data properly from the given URL&#39;});      }  const summary = await summaryGenerator.getSummary(pageContents);  res.json({ summary });});app.listen(port, () =&gt; {  console.log(`Listening to requests on http://localhost:${port}`);});In this file that has a web server with Express.js, you first require all 3 components needed to make the summarizer API work. Those are the express instance, scraper, and the  some code  file. Here is the part 1.I hope it gives you a solid base to create your Gen AI apps using the Gemini API on Vertex AI in the Google Cloud Platform. This is just scratching the surface, with the right prompts you can create APIs that can do many things like categorize text, generate other text, etc. The possibilities are endless. I hope you learned a useful skill.",
    "author": { "@type": "Person", "name": "Geshan Manandhar" },
    "publisher": {
      "@type": "Organization",
      "name": "Geshan Manandhar",
      "logo": { "@type": "ImageObject", "url": "https://geshan.com.np/images/favicons/favicon-32x32.png" }
    },
    "mainEntityOfPage": { "@type": "WebPage", "@id": "https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" }
  }</script><div class="progress-bar"></div><div class="max-w-6xl py-3 mx-auto grid-cols-12 grid gap-15 px-4 md:px-0 mb-20"><div class="col-span-12"><article class="md:w-full mx-auto"><header class="page-header text-center"><h1 class="font-semibold font-heading text-gray text-center mb-6 tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]</h1><div class="flex items-center justify-between gap-3 md:gap-4 flex-wrap md:flex-nowrap py-2 border-y border-lightbg mt-4"><div class="flex items-center justify-start md:gap-4 gap-2 flex-wrap w-2/3"><div class="flex justify-start items-center gap-3 md:gap-4"><img src="/images/favicons/favicon-32x32-pp.png" alt="Geshan Manandhar" class="w-10 h-10 rounded-full object-cover flex-shrink-0"> <span class="text-gray font-medium font-ui text-md md:text-xl uppercase tracking-wide text-start">Geshan Manandhar</span></div><time datetime="2024-02-22" data-updated="true"><time class="entry-date" datetime="2024-02-22"><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">22-Feb-2024 </span></time></time><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">14 MIN READ</span></div><button type="button" id="share-button" class="flex items-center justify-center w-8 h-8 md:w-9 md:h-9 rounded text-lightGray hover:border-gray-400 hover:bg-gray-50 transition-colors flex-shrink-0" aria-label="Share this post" onclick="toggleShareIcons(); ga('send', 'event', 'share', 'clickShareOnPost');"><img src="/images/shareIcon.svg" alt="Share this post" class="w-6 h-6"></button></div><div id="share-icons-container" class="share-icons print:hidden hidden" aria-label="Share this post"><div class="flex items-center justify-center gap-3"><span class="share-icons"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" target="_blank" title="Share 'How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]' on LinkedIn" onclick="ga('send', 'event', 'share', 'clickShareOnLinkedIn');"><span id="linkedin-share" class="text-[#0077B5]"><img src="/images/social-icons/linkedin.svg" alt="LinkedIn" class="sharing-common"> </span></a><a href="http://twitter.com/share?text=How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2] - &url=https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" target="_blank" title="Share 'How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]' on Twitter" onclick="ga('send', 'event', 'share', 'clickShareOnTwitter');"><span id="twitter-share" class="text-[#1DA1F2]"><img src="/images/social-icons/twitter.svg" alt="Twitter" class="sharing-common"> </span></a><a href="http://www.facebook.com/sharer.php?u=https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" target="_blank" title="Share 'How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]' on Facebook" onclick="ga('send', 'event', 'share', 'clickShareOnFacebook');"><span id="facebook-share" class="text-[#1877F2]"><img src="/images/social-icons/facebook.svg" alt="Facebook" class="sharing-common"> </span></a><a href="https://t.me/share/url?url=https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" target="_blank" title="Share 'How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]' on Telegram" onclick="ga('send', 'event', 'share', 'clickShareOnTelegram');"><span id="telegram-share" class="text-[#0088cc]"><img src="/images/social-icons/telegram.svg" alt="Telegram" class="sharing-common"> </span></a><a href="https://api.whatsapp.com/send?text=https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" target="_blank" title="Share 'How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]' on Whatsapp" onclick="ga('send', 'event', 'share', 'clickShareOnWhatsapp');"><span id="whatsapp-share" class="text-[#25d366]"><img src="/images/social-icons/whatsapp.svg" alt="WhatsApp" class="sharing-common"></span></a></span></div></div></header><div class="entry-content clearfix font-body text-xl text-gray"><p>Gemini by Google is a powerful LLM and in this tutorial, you will use the Gemini Pro 1.0 version to summarize text from a URL. In the previous <a href="https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs/">part</a> you learned how to set up a GCP project, try out the prompt on Vertex AI studio and then try to code on the CLI. In this part, you will refactor and converter that code to take in a URL, scrape its content, and use it to create the summary, let's get going!</p><img class="center" src="/images/gemini-vertex-ai-nodejs-api/01gemini-vertex-ai-nodejs-api.jpg" title="How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]" alt="How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]"><h2 id="table-of-contents" tabindex="-1">Table of contents <a class="direct-link" href="#table-of-contents">#</a></h2><ul><li><a href="#where-we-left-in-the-last-part">Where we left in the last part</a></li><li><a href="#build-the-node.js-api">Build the Node.js API</a><ul><li><a href="#create-gemini.js-file">Create gemini.js file</a></li><li><a href="#add-scraper.js-file">Add scraper.js file</a></li><li><a href="#new-cli.js">New cli.js</a></li><li><a href="#build-the-express.js-api">Build the Express.js API</a></li></ul></li><li><a href="#conclusion">Conclusion</a></li></ul><h2 id="where-we-left-in-the-last-part" tabindex="-1">Where we left in the last part <a class="direct-link" href="#where-we-left-in-the-last-part">#</a></h2><p>From the <a href="/blog/2024/02/gemini-vertex-ai-nodejs/">last part</a>, you have a folder called <code>summarizer-gemini</code> which has the <code>@google-cloud/vertexai</code> NPM module installed and <code>cli.js</code> file that can summarize the static text which is in the same file. When you run <code>node –no-warnings cli.js</code>, it will show you an output similar to the following:</p><img class="center" loading="lazy" src="/images/gemini-vertex-ai-nodejs/17cli-output-sync.jpg" title="Better one shot non-streamed output after changing the code to work in a sync manner" alt="Better one shot non-streamed output after changing the code to work in a sync manner"><p>After the quick recap, in the next section, you will build the API step-by-step starting with some code refactoring and reorganization. Then you will add a scraper and glue everything up with two entry points, one is a CLI and another one is a Web App with API.</p><h2 id="build-the-node.js-api" tabindex="-1">Build the Node.js API <a class="direct-link" href="#build-the-node.js-api">#</a></h2><p>As the first task for this part, you will refactor the code from <code>cli.js</code> to another file called <code>gemini.js</code>.</p><h3 id="create-gemini.js-file" tabindex="-1">Create gemini.js file <a class="direct-link" href="#create-gemini.js-file">#</a></h3><p>Create a new file called <code>gemini.js</code> and it will have the following code (which is similar to the <code>cli.js</code> file):</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> VertexAI <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@google-cloud/vertexai'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> vertex_ai <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VertexAI</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">project</span><span class="token operator">:</span> <span class="token string">'gemini-api-414910'</span><span class="token punctuation">,</span> <span class="token literal-property property">location</span><span class="token operator">:</span> <span class="token string">'us-central1'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> model <span class="token operator">=</span> <span class="token string">'gemini-pro'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> generativeModel <span class="token operator">=</span> vertex_ai<span class="token punctuation">.</span>preview<span class="token punctuation">.</span><span class="token function">getGenerativeModel</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">model</span><span class="token operator">:</span> model<span class="token punctuation">,</span><br>  <span class="token literal-property property">generation_config</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token string-property property">"max_output_tokens"</span><span class="token operator">:</span> <span class="token number">2048</span><span class="token punctuation">,</span><br>    <span class="token string-property property">"temperature"</span><span class="token operator">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span><br>    <span class="token string-property property">"top_p"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">safety_settings</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token string-property property">"category"</span><span class="token operator">:</span> <span class="token string">"HARM_CATEGORY_HATE_SPEECH"</span><span class="token punctuation">,</span><br>      <span class="token string-property property">"threshold"</span><span class="token operator">:</span> <span class="token string">"BLOCK_MEDIUM_AND_ABOVE"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token string-property property">"category"</span><span class="token operator">:</span> <span class="token string">"HARM_CATEGORY_DANGEROUS_CONTENT"</span><span class="token punctuation">,</span><br>      <span class="token string-property property">"threshold"</span><span class="token operator">:</span> <span class="token string">"BLOCK_MEDIUM_AND_ABOVE"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token string-property property">"category"</span><span class="token operator">:</span> <span class="token string">"HARM_CATEGORY_SEXUALLY_EXPLICIT"</span><span class="token punctuation">,</span><br>      <span class="token string-property property">"threshold"</span><span class="token operator">:</span> <span class="token string">"BLOCK_MEDIUM_AND_ABOVE"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token string-property property">"category"</span><span class="token operator">:</span> <span class="token string">"HARM_CATEGORY_HARASSMENT"</span><span class="token punctuation">,</span><br>      <span class="token string-property property">"threshold"</span><span class="token operator">:</span> <span class="token string">"BLOCK_MEDIUM_AND_ABOVE"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getSummary</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> prompt <span class="token operator">=</span> <span class="token string">'As an expert writer with more than a decade of experience please summarize the following in under 125 words words. You are allowed to rephrase given the summary means the same as the original text:\n\n'</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> req <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">contents</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token literal-property property">parts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prompt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> generativeModel<span class="token punctuation">.</span><span class="token function">generateContent</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> summary <span class="token operator">=</span> resp<span class="token punctuation">.</span>response<span class="token operator">?.</span>candidates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>content<span class="token operator">?.</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>text<span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> summary<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  getSummary<br><span class="token punctuation">}</span></code></pre><p>The things that have changed here is, that you have renamed the <code>getContent</code> function to <code>getSummary</code>. Then you have also removed the static text that had news about removing waste from waterways to a new variable called <code>text</code>. The <code>text</code> variable is passed in as a parameter to the <code>getSummary</code> function which makes it dynamic. Then you expose the get summary with the <code>module.exports</code> so that it can be used with require in any other file and get the returned summary.</p><p>In the next section, you will add a basic scraper using Axios and Cheerio (packaged together as axrio).</p><h3 id="add-scraper.js-file" tabindex="-1">Add scraper.js file <a class="direct-link" href="#add-scraper.js-file">#</a></h3><p>As the aim is to scrape content from a given URL, you will need to add a new NPM package. It is a mixture of <a href="https://axios-http.com/">Axios</a> and <a href="https://cheerio.js.org/">Cheerio</a> called <a href="https://www.npmjs.com/package/@geshan/axrio">Axrio</a>. The readme shows how easy it is to use to scrape any given web page. To install <code>axrio</code> you can run the following:</p><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> @geshan/axrio</code></pre><p>Running the <code>npm install</code> will result in something as follows:</p><img class="center" loading="lazy" src="/images/gemini-vertex-ai-nodejs-api/02install-axrio.jpg" title="Install axrio with NPM to scrape any web page" alt="Install axrio with NPM to scrape any web page"><p>After that you can create a new file named <code>scraper.js</code> which should have the following content:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> axrio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@geshan/axrio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getContents</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> timeoutInMs <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token keyword">await</span> axrio<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> timeoutInMs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> bodyContents <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=></span> element<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'tag'</span> <span class="token operator">?</span> <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">return</span> bodyContents<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error '</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  getContents<br><span class="token punctuation">}</span></code></pre><p>Let’s analyze the contents of this file, first, you require the <code>axrio</code> package. After that, a function named <code>getContents</code> is defined that takes in a URL parameter. In that function, you load the page contents using Axrio to a <code>$</code> const. Then you loop through all the nodes of the <code>body</code> tag. If the element is a <code>tag</code> (not a <code>script</code>) it adds it to the array (with the map). At the end, it joins all the pieces with a space in between them.</p><p>That is the contents of the page and it returns it. In case of any error, it logs the error and returns an empty string. To test this out you will create a new <code>cli.js</code> that will use both the scraper and Gemini files, next.</p><h3 id="new-cli.js" tabindex="-1">New cli.js <a class="direct-link" href="#new-cli.js">#</a></h3><p>Now let’s glue up the Scraper and the Gemini service from the new <code>cli.js</code>. The new <code>cli.js</code> will look like the below:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> scraper <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./scraper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> summaryGenerator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./gemini'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> url <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'https://7news.com.au/news/travellers-arriving-in-nsw-urged-to-check-luggage-for-unwanted-stowaway-c-13642953'</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Getting summary for url: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> \n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> pageContents <span class="token operator">=</span> <span class="token keyword">await</span> scraper<span class="token punctuation">.</span><span class="token function">getContents</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>pageContents<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token string">'Could not get data from the given URL'</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> summaryGenerator<span class="token punctuation">.</span><span class="token function">getSummary</span><span class="token punctuation">(</span>pageContents<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Here, you first require the <code>scraper.js</code> and the <code>gemini.js</code> as <code>summaryGenerator</code>. Then you have an async <a href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE">IIEF</a> - Immediately Invoked Function Expression which parses the URL from the CLI parameters. If the URL is not provided it falls back to a News post from 7News. Then it prints the URL it is going to use for scraping and ultimately generating a summary.</p><p>After that, it sends the URL to the scraper’s <code>getContents</code> function to get the contents of that web page. If there is no content (even due to an error) it returns <code>could not get data from the given URL</code> else it sends the page contents to the <code>getSummary</code> of the <code>gemini.js</code> file to get the summary.</p><p>If you run this script with <code>node --no-warnings cli.js https://7news.com.au/news/advice-for-swifties-on-getting-to-taylor-swifts-eras-tour-shows-at-sydney-olympic-park-c-13672302</code> it will show something like the below:</p><img class="center" loading="lazy" src="/images/gemini-vertex-ai-nodejs-api/03updated-cli.jpg" title="New CLI file that can take in the URL scrape it and send out the summary" alt="New CLI file that can take in the URL scrape it and send out the summary"><p>Now the summarizer is working in the CLI, if you don’t provide a URL it will fallback to the 7News luggage URL. There is a two-second timeout for fetching the page so it will throw an error for slow websites. There is no validation of the URL and other things can be made better too. In the next section, you will add it working as an API.</p><h3 id="build-the-express.js-api" tabindex="-1">Build the Express.js API <a class="direct-link" href="#build-the-express.js-api">#</a></h3><p>To build the API layer on your summarizer using Gemini you will need to install Express.js first with:</p><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> express</code></pre><p>It will look like the below when express is installed with NPM:</p><img class="center" loading="lazy" src="/images/gemini-vertex-ai-nodejs-api/04install-express.jpg" title="Install latest Express.js with npm install" alt="Install latest Express.js with npm install"><p>Then you can add a file named <code>index.js</code> on the root with the following contents:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> scraper <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./scraper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> summaryGenerator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./gemini'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token string">'3000'</span><span class="token punctuation">;</span><br><br>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'alive'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/summary'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token operator">?.</span>url <span class="token operator">||</span> <span class="token string">'https://7news.com.au/news/travellers-arriving-in-nsw-urged-to-check-luggage-for-unwanted-stowaway-c-13642953'</span><span class="token punctuation">;</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//validates if given string is a valid URL</span><br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">provider URL </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not a valid URL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Getting summary for url: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> \n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> pageContents <span class="token operator">=</span> <span class="token keyword">await</span> scraper<span class="token punctuation">.</span><span class="token function">getContents</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>pageContents<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">501</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'Could not get data properly from the given URL'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <br>  <span class="token punctuation">}</span><br>  <span class="token keyword">const</span> summary <span class="token operator">=</span> <span class="token keyword">await</span> summaryGenerator<span class="token punctuation">.</span><span class="token function">getSummary</span><span class="token punctuation">(</span>pageContents<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> summary <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Listening to requests on http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>In this file that has a web server with Express.js, you first require all 3 components needed to make the summarizer API work. Those are the express instance, scraper, and the <code>gemini.js</code> file required as the <code>summaryGenerator</code> const.</p><p>Then, you instantiate a new express app as the <code>app</code> const and pull in the port from the environment variable. If the environment variable of <code>PORT</code> is not set you fall back to port <code>3000</code>.</p><p>The first route you have added for the Express app is <code>/</code> which returns a JSON object with a <code>message</code> key that has the value <code>alive</code>. This acts like a health check for the summarizer API.</p><p>After that the bulk of the work is taking place in the <code>/summary</code> GET API route. Here you try to get the <code>url</code> from the query parameter <code>url</code> if not found, you fall back to the news story about luggage in NSW by 7News. It also checks if the given string is a valid URL using the <code>new URL</code> construct. If it is not a valid URL the API responds with a status code of <code>400</code> and a relevant message.</p><p>Then you log the URL to know which web page is being scraped. Subsequently, you scrape the content of that URL’s web page by passing the URL in the scraper’s <code>getContent</code> function. It will return the contents of the page if things go fine else it will come back with an empty string. The case of the empty string being returned will translate into a 501 response with the message <code>Could not get data properly from the given URL</code>. This can happen if the URL takes more than 2 seconds to respond or the data cannot be easily parsed by the scraper.</p><p>If all goes well it will respond with the summary in the <code>summary</code> key of the response. At the end of the file the web server is started with the <code>app.listen</code> call with a log when the server starts.</p><p>You can run it with <code>node index.js</code>, for local development you can also use <a href="/blog/2021/02/nodemon/">nodemon</a>. You can also add it as the <code>npm start</code> script in the <code>package.json</code> file’s script section as highlighted below:</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><mark class="highlight-line highlight-line-active">  <span class="token string-property property">"start"</span><span class="token operator">:</span> <span class="token string">"node index.js"</span><span class="token punctuation">,</span></mark><br><span class="highlight-line">  <span class="token string-property property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span></code></pre><p>Then you can run <code>npm start</code> on the root of the folder which will give the following output:</p><img class="center" loading="lazy" src="/images/gemini-vertex-ai-nodejs-api/05npm-start.jpg" title="Start the summarizer API Express.js server with npm start" alt="Start the summarizer API Express.js server with npm start"><p>After that if you go to your favorite browser and hit <code>http://localhost:3000/summary?url=https://developer.mozilla.org/en-US/docs/Glossary/IIFE</code> on the address bar you will see something like the below (if everything went fine):</p><img class="center" loading="lazy" src="/images/gemini-vertex-ai-nodejs-api/06gemini-summarizer-api-working.jpg" title="Gemini based text summarizer API working with Node.js and Express" alt="Gemini based text summarizer API working with Node.js and Express"><p>There you have it, you have successfully converted the sample that you got from Vertex AI - <code>Get Code</code> section into a working API. You can easily deploy it to a service like Cloud Run on GCP with or without Dockerzing the app. If you push your code to GitHub you can also use <a href="/blog/2024/01/cloud-shell-editor/">Cloud Shell Editor</a> to get and deploy the code to Cloud Run, which can be a topic for another blog post. To deploy this code on Cloud Run, some other things will need to be dynamic or picked from the environment variables like the GCP project and GCP location.</p><p>The code is also available as an open-source <a href="https://github.com/geshan/summarizer-gemini">GitHub repository</a> for your reference.</p><p>You can also create a <a href="/blog/2024/04/gemini-ecommerce-product-description-generator/">e-commerce product description generator</a> using Gemini over Vertex AI that takes in pictures and a prompt to give out a decent product description. Try it.</p><h2 id="conclusion" tabindex="-1">Conclusion <a class="direct-link" href="#conclusion">#</a></h2><p>In part 2 of this tutorial, you were able to convert the sample code into a full-fledged API. You also have a quick way to test out any URL using the modified <code>cli.js</code> file. Here is the <a href="/blog/2024/02/gemini-vertex-ai-nodejs/">part 1</a>.</p><p>I hope it gives you a solid base to create your Gen AI apps using the Gemini API on Vertex AI in the Google Cloud Platform. This is just scratching the surface, with the right prompts you can create APIs that can do many things like categorize text, generate other text, etc. The possibilities are endless. I hope you learned a useful skill.</p></div><div class="flex items-center justify-between gap-3 md:gap-4 flex-wrap md:flex-nowrap py-2 border-y border-lightbg mt-4"><div class="flex items-center justify-start md:gap-4 gap-2 flex-wrap w-2/3"><div class="flex justify-start items-center gap-3 md:gap-4"><img src="/images/favicons/favicon-32x32-pp.png" alt="Geshan Manandhar" class="w-10 h-10 rounded-full object-cover flex-shrink-0"> <span class="text-gray font-medium font-ui text-md md:text-xl uppercase tracking-wide text-start">Geshan Manandhar</span></div><time datetime="2024-02-22" data-updated="true"><time class="entry-date" datetime="2024-02-22"><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">22-Feb-2024 </span></time></time><span class="text-textColor font-ui font-medium text-md md:text-xl uppercase">14 MIN READ</span></div><button type="button" id="share-button-bottom" class="flex items-center justify-center w-8 h-8 md:w-9 md:h-9 rounded text-lightGray hover:border-gray-400 hover:bg-gray-50 transition-colors flex-shrink-0" aria-label="Share this post" onclick="toggleShareIconsBottom(); ga('send', 'event', 'share', 'clickShareOnPost');"><img src="/images/shareIcon.svg" alt="Share this post" class="w-6 h-6"></button></div><div id="share-icons-container-bottom" class="share-icons-bottom print:hidden hidden mx-auto" aria-label="Share this post"><div class="w-full flex items-center justify-center mx-auto gap-3"><span class="share-icons"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" target="_blank" title="Share 'How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]' on LinkedIn" onclick="ga('send', 'event', 'share', 'clickShareOnLinkedIn');"><span id="linkedin-share" class="text-[#0077B5]"><img src="/images/social-icons/linkedin.svg" alt="LinkedIn" class="sharing-common"> </span></a><a href="http://twitter.com/share?text=How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2] - &url=https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" target="_blank" title="Share 'How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]' on Twitter" onclick="ga('send', 'event', 'share', 'clickShareOnTwitter');"><span id="twitter-share" class="text-[#1DA1F2]"><img src="/images/social-icons/twitter.svg" alt="Twitter" class="sharing-common"> </span></a><a href="http://www.facebook.com/sharer.php?u=https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" target="_blank" title="Share 'How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]' on Facebook" onclick="ga('send', 'event', 'share', 'clickShareOnFacebook');"><span id="facebook-share" class="text-[#1877F2]"><img src="/images/social-icons/facebook.svg" alt="Facebook" class="sharing-common"> </span></a><a href="https://t.me/share/url?url=https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" target="_blank" title="Share 'How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]' on Telegram" onclick="ga('send', 'event', 'share', 'clickShareOnTelegram');"><span id="telegram-share" class="text-[#0088cc]"><img src="/images/social-icons/telegram.svg" alt="Telegram" class="sharing-common"> </span></a><a href="https://api.whatsapp.com/send?text=https://geshan.com.np/blog/2024/02/gemini-vertex-ai-nodejs-api/" target="_blank" title="Share 'How to create a text summarizer API using Gemini on Vertex AI with Node.js a step-by-step guide [Part 2]' on Whatsapp" onclick="ga('send', 'event', 'share', 'clickShareOnWhatsapp');"><span id="whatsapp-share" class="text-[#25d366]"><img src="/images/social-icons/whatsapp.svg" alt="WhatsApp" class="sharing-common"></span></a></span></div></div></article><div class="mt-3"><a href="/blog/categories/ai/" title="AI" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">ai </a><a href="/blog/categories/gen-ai/" title="Gen AI" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">gen ai </a><a href="/blog/categories/node.js/" title="Node.js" class="background-lightbg mr-4 mb-2 inline-block mt-2 rounded border-2 bg-gray-100 font-semibold font-ui text-gray hover:text-gray-400 px-3 py-1 text-xl border-gray-300 cursor-pointer hover:border-gray-400">node.js</a></div><section class="md:w-full mx-auto mt-4"><h3 class="comments font-heading">Comments</h3><div id="disqus_thread"></div><button id="disqus_trigger" class="font-ui text-blackText hover:border-darkAvocado border-blacktext hover:shadow-lg border-2 transition ease-in-out delay-100 px-3 py-2 pt-2 mt-2 rounded-md text-center block h-auto text-xl" onclick="load_disqus()">Post a Comment</button><div id="disqus_thread" aria-live="polite"></div></section></div></div><section class="md:w-full mx-auto mt-4 bg-lightAvocado p-4 rounded-lg pb-8"><div class="max-w-6xl mx-auto md:py-12 px-4"><h2 class="text-4xl text-darkAvocado font-heading font-regular flex-shrink-0 py-8 tracking-normal leading-[105%] md:leading-[105%]"><span class="text-lightGray italic">Related</span> <span class="text-blackText">Blogs</span></h2><div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2024/02/gemini-vertex-ai-nodejs/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to create a text summarizer using Gemini over Vertex AI with Node.js a step-by-step guide [Part 1]</a> <time class="font-medium text-xl text-textColor uppercase font-ui">21-Feb-2024 &nbsp;&nbsp;&nbsp; 12 min read</time><p class="text-xl text-gray font-ui">Learn how to create a simple summarizer with Gemini API on Vertex AI with Node.js that runs on the CLI.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2025/11/google-ai-studio-build/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to build your own resume reviewer with Google AI Studio in minutes</a> <time class="font-medium text-xl text-textColor uppercase font-ui">14-Nov-2025 &nbsp;&nbsp;&nbsp; 9 min read</time><p class="text-xl text-gray font-ui">Learn how to build your own resume reviewer with Google AI Studio in minutes and deploy it on Google Cloud Run.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2025/05/google-ai-studio-apps/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">Google AI Studio: How to go from a prompt to a geo-location guessing app in minutes</a> <time class="font-medium text-xl text-textColor uppercase font-ui">22-May-2025 &nbsp;&nbsp;&nbsp; 10 min read</time><p class="text-xl text-gray font-ui">Learn how to generate, create and deploy a geo-location guessing app using Google AI Studio and run it on Google Cloud Run step by step.</p></div><div class="py-4 border-b border-avocado pb-4 flex flex-col gap-2 font-ui"><a href="/blog/2025/01/controlled-generation-gemini/" class="font-semibold font-ui text-gray text-xl md:text-2xl tracking-[-0.01em] leading-[105%] md:leading-[105%]">How to use Gemini over Vertex AI to summarize and categorize job listings with controlled generation</a> <time class="font-medium text-xl text-textColor uppercase font-ui">26-Jan-2025 &nbsp;&nbsp;&nbsp; 14 min read</time><p class="text-xl text-gray font-ui">Learn how to use controlled generation in Gemini over Vertex AI for the output to adhere to a given schema with a real life job listings example.</p></div></div></div></section><section class="bg-avocado md:py-0 py-12 px-4"><div class="max-w-6xl mx-auto"><div class="md:hidden"><h2 class="mb-4 text-3xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-base text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-base text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity w-full text-center">Follow on LinkedIn &nbsp;→</a></div><div class="hidden md:grid lg:hidden grid-cols-3 gap-8 items-center"><div class="z-10 col-span-2"><h2 class="mb-4 text-2xl md:text-4xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-xl text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-xl text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity">Follow on LinkedIn &nbsp;→</a></div><div class="flex items-center justify-end col-span-1"><img class="w-32 h-auto" src="/images/theme/new_logo.svg" alt="Geshan"></div></div><div class="hidden lg:grid grid-cols-2 gap-8 lg:gap-12 items-center justify-between h-full"><div class="z-10"><h2 class="mb-4 text-2xl md:text-4xl font-heading font-regular text-textColor break-words tracking-[-0.01em] leading-[105%] md:leading-[105%]"><span class="text-textColor italic">Stay</span><span class="text-blackText"> Connected</span></h2><p class="text-xl text-blackText font-body font-regular mb-6">Follow me on LinkedIn for new posts, engineering insights, and tech takes — straight from the trenches.</p><p class="text-xl text-blackText font-body font-regular mb-6">A big thank you for supporting this ad. free, unobstructive (no overlays, no pop-ups) blog.</p></div><div class="flex items-center gap-12 w-full md:w-auto justify-end self-end"><img class="w-16 md:w-32 h-auto" src="/images/theme/new_logo.svg" alt="Geshan"> <a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer" class="inline-block bg-darkAvocado text-xl text-white px-6 py-3 rounded-lg font-body font-regular hover:opacity-90 transition-opacity w-full md:w-auto text-center md:text-left">Follow on LinkedIn &nbsp;→</a></div></div></div></section></div></div></div></main><footer role="contentinfo"><footer class="bg-avocado sm:px-4"><div class="max-w-6xl mx-auto flex flex-col md:flex-row sm:flex-col justify-between gap-2 items-center sm:items-center md:items-center py-10 font-nav text-lightGray text-base font-regular"><div class="pb-0 sm:pb-2 text-gray"><span class="pr-4">Copyright © 2026 Geshan Manandhar.</span></div><div class="pb-0 sm:pb-2"><ul class="flex"><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://www.linkedin.com/in/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> LinkedIn</a></li><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://www.twitter.com/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> Twitter</a></li><li class="hover:text-gray-300 text-lg pr-4 cursor-pointer text-gray"><a href="https://github.com/geshan" target="_blank" rel="noopener noreferrer nofollow" class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 1000 1000"><path fill="currentColor" d="M1000 267q0 112-78 188L747 631q-78 78-189 78q-97 0-171-63l115-115q26 17 56 17q44 0 75-31l175-176q31-29 31-74q0-44-30.5-74.5T734 162q-25 0-49.5 12T652 208H414L546 79Q626 1 734 1q110 0 188 78t78 188zm-387 89L498 471q-26-17-56-17q-44 0-75 31L192 661q-31 29-31 74q0 44 30.5 74.5T266 840q25 0 49.5-12t32.5-34h238L454 923q-80 78-188 78q-110 0-188-78T0 735q0-112 78-188l175-176q78-78 189-78q97 0 171 63z"/></svg> Github</a></li></ul></div></div></footer></footer><script src="/js/all.min.js" defer="defer"></script></body></html>