---
layout: post
title: "Control book outline form and menu for specified Drupal node types"
date: 2009-11-16T05:54:00+04:00
comments: true
tags:
 - Tutorial
 - Programming
 - PHP
 - Drupal
 - Web Development
---

<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">Drupal has a good potential to be used as a blog, forum (some what), wiki or any other dedicated web application or combination of two or more services. Drupal as a wiki, out of the box is a little weird. Problem is <a href="http://drupal.org/" target="_blank">Drupal</a> organizes wiki as book pages and books and book pages are related. Some people might not agree that book node/content type is a form of wiki but they can be used as one.<br /><br /><br /><h3>Problem: </h3>The problem using Drupal book module and book pages as wiki is, the book page module adds book outline form part and the book outline menu as node/x/outline to all node types. All the node types do not need to be part of a book/wiki page. So this is the awkward part. I had to develop an application that had a wiki as a part with blogs and events as other services. So I faced this problem.<br /><br /><h3>The Search: </h3>Then I searched for the solution to show book outline form part and the book outline module in only specified Drupal nodes/content types. At the d.o (I hear this in all screencasts and podcasts - its Drupal.org ;) ) site I found this node: <a href="http://drupal.org/node/251798" target="_blank">http://drupal.org/node/251798</a> - and a code snippet by <a href="http://drupal.org/user/78454" target="_blank">mooffie</a>. But the code was very basic and not configurable or flexible.<br /><br /><h3>A Simple Move:</h3>I decided to use the code as it was a solution to my problem but also thought to make a configurable module out of it. So the module is called nobookoutline now, I have not put it in d.o as I'm not confident of getting a CVS account :). Here is the download <a href="http://www.mediafire.com/file/tmztxnyywwy/nobookoutline.zip" target="_blank">link</a> for the module.<br /><h3>The Solution: </h3>The module provides a user interface to select which node/content types you want to show the book outline form and /outline menu option to. Below is the screen-shot of the page you can see in Admin&gt;&gt; Content&gt;&gt; Book Outline Settings after you download and enable the module and login as site admin. you can access the page by going to&nbsp; admin/content/nobookoutline.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/_L4bRnZ5TPr8/SwCusTXoQkI/AAAAAAAABKQ/V7Gxj-jdxzw/s1600/nobookoutline01.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><br /></a><a href="https://2.bp.blogspot.com/_L4bRnZ5TPr8/SwCyqYsu3PI/AAAAAAAABKo/7KGk8s5CL0o/s1600/nobookoutline01.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/_L4bRnZ5TPr8/SwCyqYsu3PI/AAAAAAAABKo/7KGk8s5CL0o/s320/nobookoutline01.png" height="213" width="320" /></a></div><br />After you select the appropriate node types and click save the book outline form and the menu node/x/outline will only appear on the desired node types. Like below:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/_L4bRnZ5TPr8/SwCvJGIrKII/AAAAAAAABKY/gpAv2_4kCek/s1600/nobookoutline03.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><br /></a><a href="https://2.bp.blogspot.com/_L4bRnZ5TPr8/SwCsPDfzknI/AAAAAAAABKI/iZnH8ynUYV0/s1600/nobookoutline02.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/_L4bRnZ5TPr8/SwCsPDfzknI/AAAAAAAABKI/iZnH8ynUYV0/s400/nobookoutline02.png" /></a></div><br /><br />Below is a book node that has outline, other nodes will not have the outline menu unless they are selected in the configuration page.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/_L4bRnZ5TPr8/SwCvZsM9VKI/AAAAAAAABKg/cJodDnhPCa0/s1600/nobookoutline04.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/_L4bRnZ5TPr8/SwCvZsM9VKI/AAAAAAAABKg/cJodDnhPCa0/s320/nobookoutline04.png" /></a></div><br />The book outline menu appears only for selected node types.<br /><br /><h3>Edited Code:</h3>The code has been edited to accommodate the new configuration page and here is a snippet below:<br /><br /><pre class="php" name="code">&lt;?php<br /><br /><br />/**<br /> * Implementation of hook_form_alter<br /> * @param $form<br /> * @param $form_state<br /> * @param $form_id<br /> * @return NULL<br /> */<br />function nobookoutline_form_alter(&amp;$form, $form_state, $form_id) {<br />  <br />   if (isset($form['#node']) &amp;&amp; $form_id == $form['#node']-&gt;type .'_node_form') {<br />      $node = $form['#node'];      <br />      // If it's not a book node, remove the Book Outline box:<br />      // now get settings as set.<br />      $nodetypes = variable_get('form_nobookoutline_nodetypes', array('book'));<br />      if(!in_array($node-&gt;type, $nodetypes)) {<br />        $form['book']['#access'] = FALSE;<br />      }<br />   }<br />}<br /><br /><br />/**<br /> * implementation of hook_menu_alter<br /> * @param $callbacks<br /> * @return unknown_type<br /> */<br />function nobookoutline_menu_alter(&amp;$callbacks) {<br />  // We install our own access callback to check if node is book type<br />  $callbacks['node/%node/outline']['access callback'] = '_nobookoutline_restrict_outline_tab';<br />}<br /><br />// Additional access control for the 'Outline' tab: don't show for non 'book' nodes...<br />function _nobookoutline_restrict_outline_tab($node) {<br />  $nodetypes = variable_get('form_nobookoutline_nodetypes', array('book'));<br />  <br />  if(!in_array($node-&gt;type, $nodetypes)) {<br />     <br />    return FALSE;<br />  }<br />  // Delegate to the original access callback:<br />  return _book_outline_access($node);<br />}<br /><br /><br />?&gt;<br /><br /></pre><br />What the code does is, it just restricts access to the form part and the menu link.<br /><h3>Conclusion</h3>The module can be made better with permissions but is functional enough for now. Hope it solves your problem.<br /><br /><br /><blockquote>Using Drupal as a wiki will not be a big deal if this minor issue is resolved. Happy Drupalling. </blockquote></div></div>
